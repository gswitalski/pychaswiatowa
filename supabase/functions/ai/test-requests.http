### AI Recipe Draft - Test Requests
### Local endpoint: http://localhost:54321/functions/v1/ai/recipes/draft

### Variables
@baseUrl = http://localhost:54321/functions/v1/ai
@token = {{$processenv SUPABASE_LOCAL_TOKEN}}

### Test 1: Recipe with tips (text source)
POST {{baseUrl}}/recipes/draft
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "source": "text",
    "text": "Naleśniki z serem\n\nSkładniki:\n2 jajka\n250 ml mleka\n150 g mąki\n500 g sera białego\n3 łyżki cukru\n\nWykonanie:\nWymieszać jajka z mlekiem.\nDodać mąkę i wymieszać na gładkie ciasto.\nUsmażyć cienkie naleśniki.\nSer wymieszać z cukrem.\nNałożyć farsz na naleśniki i zrolować.\n\nWskazówki:\nNaleśniki można zamrozić.\nPodawać z owocami lub sosem czekoladowym.\nZamiast sera można użyć dżemu.",
    "output_format": "pycha_recipe_draft_v1",
    "language": "pl"
}

### Test 2: Recipe without tips (text source)
POST {{baseUrl}}/recipes/draft
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "source": "text",
    "text": "Jajecznica\n\nSkładniki:\n3 jajka\nsól\nmasło\n\nWykonanie:\nRozbić jajka do miski.\nDodać sól.\nRoztopić masło na patelni.\nWlać jajka i mieszać.",
    "output_format": "pycha_recipe_draft_v1",
    "language": "pl"
}

### Test 3: Recipe with structured tips (text source)
POST {{baseUrl}}/recipes/draft
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "source": "text",
    "text": "Pierogi z kapustą i grzybami\n\nSKŁADNIKI:\n\nCiasto:\n500 g mąki\n250 ml wody\n1 jajko\n\nFarsz:\n500 g kapusty kiszonej\n100 g suszonych grzybów\n2 cebule\nsól, pieprz\n\nWYKONANIE:\n1. Wymieszać składniki na ciasto i odstawić na 30 minut.\n2. Namoczone grzyby ugotować i pokroić.\n3. Kapustę pokroić drobno.\n4. Cebulę pokroić w kostkę i zeszklić.\n5. Wymieszać farsz: kapustę, grzyby, cebulę.\n6. Wyrobić ciasto i wyciąć kółka.\n7. Nałożyć farsz i skleić pierogi.\n8. Ugotować w osolonej wodzie.\n\nWSKAZÓWKI:\n\nPrzechowywanie:\n- Pierogi można zamrozić na surowo\n- Zamrożone gotować bez rozmrażania\n\nPodawanie:\n- Podawać ze skwarkami\n- Smakują też z cebulką i grzybkami\n\nWarianty:\n- Można dodać suszone śliwki do farszu\n- Zamiast wody użyć wywaru z grzybów",
    "output_format": "pycha_recipe_draft_v1",
    "language": "pl"
}

### Test 4: Invalid request - missing required field
POST {{baseUrl}}/recipes/draft
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "source": "text",
    "output_format": "pycha_recipe_draft_v1"
}

### Test 5: Invalid request - not a recipe
POST {{baseUrl}}/recipes/draft
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "source": "text",
    "text": "To jest zwykły tekst, który nie zawiera żadnego przepisu kulinarnego. Jest to tylko test obsługi błędów.",
    "output_format": "pycha_recipe_draft_v1",
    "language": "pl"
}

### Test 6: Recipe with tips in English
POST {{baseUrl}}/recipes/draft
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "source": "text",
    "text": "Chocolate Chip Cookies\n\nIngredients:\n200g butter\n150g sugar\n2 eggs\n300g flour\n200g chocolate chips\n\nInstructions:\nCream butter and sugar.\nAdd eggs and mix.\nAdd flour and chocolate chips.\nForm small balls and place on baking sheet.\nBake at 180°C for 12 minutes.\n\nTips:\nCookies are best when slightly underbaked.\nStore in airtight container.\nYou can use dark or milk chocolate.",
    "output_format": "pycha_recipe_draft_v1",
    "language": "en"
}

### ============================================
### AI Normalized Ingredients - Test Requests
### ============================================

### Test 7: Valid normalized ingredients request
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "header", "content": "Ciasto" },
        { "type": "item", "content": "1 kg mąki" },
        { "type": "item", "content": "2 łyżki cukru" },
        { "type": "item", "content": "do smaku sól" },
        { "type": "item", "content": "3 jajka" },
        { "type": "header", "content": "Dodatki" },
        { "type": "item", "content": "pęczek koperku" },
        { "type": "item", "content": "2 ząbki czosnku" },
        { "type": "item", "content": "500 ml mleka" }
    ],
    "allowed_units": ["g", "ml", "szt.", "ząbek", "łyżeczka", "łyżka", "szczypta", "pęczek"]
}

### Test 8: Ambiguous ingredients (only "do smaku")
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "item", "content": "do smaku sól" },
        { "type": "item", "content": "opcjonalnie pieprz" },
        { "type": "item", "content": "na oko odrobina cynamonu" }
    ],
    "allowed_units": ["g", "ml", "szt.", "łyżeczka", "łyżka", "szczypta"]
}

### Test 9: Only headers (should return 400)
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "header", "content": "Składniki" },
        { "type": "header", "content": "Dodatki" }
    ],
    "allowed_units": ["g", "ml", "szt."]
}

### Test 10: Invalid allowed_units (not from supported list - should return validation error)
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "item", "content": "1 kg mąki" }
    ],
    "allowed_units": ["kg", "litr", "filiżanka"]
}

### Test 11: Missing token (should return 401)
POST {{baseUrl}}/recipes/normalized-ingredients
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "item", "content": "1 kg mąki" }
    ],
    "allowed_units": ["g", "ml"]
}

### Test 12: Recipe ID not owned (should return 404)
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 999999,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "item", "content": "1 kg mąki" }
    ],
    "allowed_units": ["g", "ml"]
}

### Test 13: Missing required field (should return 400)
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "allowed_units": ["g", "ml"]
}

### Test 14: Complex ingredients with conversions
POST {{baseUrl}}/recipes/normalized-ingredients
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "recipe_id": 1,
    "output_format": "pycha_normalized_ingredients_v1",
    "language": "pl",
    "ingredients": [
        { "type": "item", "content": "0.5 kg mąki pszennej" },
        { "type": "item", "content": "5 dag masła" },
        { "type": "item", "content": "1 l mleka" },
        { "type": "item", "content": "1 szczypta soli" },
        { "type": "item", "content": "2 łyżki stołowe cukru" },
        { "type": "item", "content": "3 łyżeczki proszku do pieczenia" }
    ],
    "allowed_units": ["g", "ml", "szt.", "łyżeczka", "łyżka", "szczypta"]
}
