<pych-page-header
    [title]="pageTitle()"
/>

<div class="collection-details-page">
    <!-- Stan ładowania (początkowy) -->
    @if (isLoading() && !hasData()) {
        <div class="loading-container">
            <mat-spinner diameter="48"></mat-spinner>
            <p>Ładowanie kolekcji...</p>
        </div>
    }

    <!-- Stan błędu -->
    @if (error(); as errorObj) {
        <div class="error-container">
            <mat-icon class="error-icon">error_outline</mat-icon>
            <h2>Wystąpił błąd</h2>
            <p>{{ errorObj.message }}</p>
            <div class="error-actions">
                <button mat-flat-button color="primary" (click)="navigateBack()">
                    Wróć do listy kolekcji
                </button>
                @if (errorObj.kind === 'server' || errorObj.kind === 'unknown') {
                    <button mat-stroked-button (click)="retry()">
                        Spróbuj ponownie
                    </button>
                }
            </div>
        </div>
    }

    <!-- Zawartość kolekcji -->
    @if (hasData()) {
        <pych-collection-header [collectionData]="collectionData()" />

        <!-- Ostrzeżenie o truncacji -->
        @if (isTruncated()) {
            <div class="truncation-warning">
                <mat-icon>info</mat-icon>
                <span>
                    Wyświetlono tylko część przepisów z powodu ograniczeń technicznych. 
                    Niektóre przepisy mogą nie być widoczne.
                </span>
            </div>
        }

        <section class="recipes-section">
            <h2 class="section-title">
                Przepisy w kolekcji
                @if (totalRecipesCount() > 0) {
                    <span class="recipes-count">({{ totalRecipesCount() }})</span>
                }
            </h2>

            @if (isEmpty()) {
                <div class="empty-state">
                    <mat-icon>restaurant</mat-icon>
                    <h3>Brak przepisów</h3>
                    <p>Ta kolekcja nie zawiera jeszcze żadnych przepisów.</p>
                    <p class="hint">Dodaj przepisy do kolekcji z poziomu strony przepisu.</p>
                    <button mat-flat-button color="primary" (click)="navigateBack()">
                        Wróć do listy kolekcji
                    </button>
                </div>
            } @else {
                <pych-recipe-list
                    [recipes]="recipeListItems()"
                    [isLoading]="isLoading()"
                    [showRemoveAction]="true"
                    [usePaginator]="false"
                    (removeRecipe)="onRemoveRecipe($event)"
                />
            }
        </section>
    }
</div>

