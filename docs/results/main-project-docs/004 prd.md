23# Dokument wymagań produktu (PRD) - PychaŚwiatowa

## 1. Przegląd produktu

PychaŚwiatowa to responsywna aplikacja webowa zaprojektowana dla pasjonatów gotowania, służąca jako centralna, cyfrowa książka kucharska. Jej głównym celem jest umożliwienie użytkownikom łatwego gromadzenia, organizowania i przeszukiwania własnych przepisów kulinarnych w jednym miejscu. Wersja MVP (Minimum Viable Product) skupia się na podstawowych funkcjonalnościach zarządzania przepisami, kategoryzacji, tworzenia kolekcji i wyszukiwania. Aplikacja jest projektowana w podejściu "desktop-first", zapewniając optymalne doświadczenie na większych ekranach, jednocześnie zachowując pełną funkcjonalność na urządzeniach mobilnych.

## 2. Problem użytkownika

Domowi kucharze przechowują swoje przepisy w wielu rozproszonych miejscach, takich jak fizyczne notatniki, książki kucharskie, wycinki z gazet oraz liczne źródła cyfrowe — strony internetowe, aplikacje czy dokumenty. Ta fragmentacja informacji sprawia, że zarządzanie kolekcją przepisów jest nieefektywne i czasochłonne. Utrudnia to nie tylko szybkie odnajdywanie potrzebnych receptur, ale także uniemożliwia sprawne planowanie posiłków i kreatywne wykorzystanie posiadanej wiedzy kulinarnej.

Głównym problemem, który PychaŚwiatowa ma rozwiązać, jest brak centralnego, łatwo dostępnego miejsca do gromadzenia, organizowania i przeszukiwania przepisów kulinarnych. Aplikacja ma na celu zastąpienie chaotycznego systemu opartego na wielu źródłach jednym, spójnym narzędziem, które stanie się osobistą, cyfrową książką kucharską użytkownika.

## 3. Wymagania funkcjonalne

### 3.1. System kont użytkowników
- Użytkownicy mogą tworzyć konto za pomocą adresu e-mail, nazwy użytkownika oraz hasła.
- Proces rejestracji wymaga **potwierdzenia adresu e-mail** przez użytkownika:
    - po rejestracji system wysyła na podany adres e-mail link weryfikacyjny,
    - użytkownik nie może się zalogować, dopóki nie potwierdzi e-maila,
    - po kliknięciu w link użytkownik widzi komunikat potwierdzający i może przejść do logowania.
- System udostępnia możliwość **ponownej wysyłki linku weryfikacyjnego** (z ograniczeniem częstotliwości).
- Użytkownicy mogą logować się i wylogowywać ze swojego konta.
- Każdy użytkownik ma przypisaną **dokładnie jedną rolę aplikacyjną** (`user`, `premium`, `admin`):
    - `user` – rola domyślna przy założeniu konta,
    - `premium` – użytkownik z dostępem do funkcji premium,
    - `admin` – użytkownik z dostępem do wszystkich funkcji (w tym administracyjnych).
- Rola użytkownika jest dostępna po stronie klienta poprzez **claim w JWT** (np. `app_role`) od razu po zalogowaniu i może zostać użyta do przydzielania dostępu do wybranych funkcjonalności w przyszłości.
- Nadawanie/zmiana roli **nie jest realizowane w UI** w MVP – role mogą być aktualizowane bezpośrednio w bazie danych.
- Każdy użytkownik ma dostęp wyłącznie do swojej prywatnej kolekcji przepisów.

### 3.2. Zarządzanie przepisami (CRUD)
-   *Tworzenie (Create):* Użytkownik może dodawać nowe przepisy poprzez formularz. Formularz zawiera pola na nazwę, opis, **liczbę porcji (opcjonalnie)**, **czas przygotowania (opcjonalnie)**, **czas całkowity (opcjonalnie)**, **flagę "Termorobot" (opcjonalnie)**, **flagę "Grill" (opcjonalnie)**, **typ diety: `Mięso` / `Wege` / `Vegan` (opcjonalnie)**, **kuchnię (opcjonalnie; lista kontrolowana)**, **stopień trudności: `Łatwe` / `Średnie` / `Trudne` (opcjonalnie)**, zdjęcie oraz pola na listy: składniki, kroki oraz **wskazówki (opcjonalnie)**. System automatycznie parsuje tekst wklejony do pól list, traktując każdą nową linię jako osobny element. Linie rozpoczynające się od znaku `#` (np. `#Ciasto`) są interpretowane jako nagłówki sekcji.
-   *Odczyt (Read):* Przepisy są wyświetlane w czytelnym, dwukolumnowym układzie na urządzeniach desktopowych (kroki po lewej, składniki po prawej). Na górze znajduje się nazwa i opis (lewa strona) oraz zdjęcie (prawa strona). Jeśli użytkownik uzupełnił liczbę porcji, jest ona wyświetlana **bezpośrednio pod tytułem przepisu** (np. `4 porcje`, `6 porcji`). Jeśli użytkownik uzupełnił czasy, są one wyświetlane **pod opisem** w formie metadanych z ikonkami (czas przygotowania i czas całkowity). Jeśli użytkownik uzupełnił pola klasyfikacyjne (typ diety, kuchnia, stopień trudności), są one wyświetlane w szczegółach jako czytelne metadane (np. chipy/badge); jeśli nie są ustawione, nie są wyświetlane. Jeśli przepis ma ustawioną flagę **"Termorobot"** lub **"Grill"**, są one widoczne w szczegółach jako czytelne metadane (np. chip/badge z ikoną i etykietą). Jeśli przepis ma ustawione **wskazówki**, są one wyświetlane jako **osobna sekcja** pod listą kroków przygotowania; jeśli brak wskazówek (pusta lista), sekcja nie jest wyświetlana.
-   *Aktualizacja (Update):* Użytkownik może edytować każdy element zapisanego przepisu (nazwę, opis, **liczbę porcji (opcjonalnie)**, **czas przygotowania (opcjonalnie)**, **czas całkowity (opcjonalnie)**, **flagę "Termorobot" (opcjonalnie)**, **flagę "Grill" (opcjonalnie)**, **typ diety (opcjonalnie)**, **kuchnię (opcjonalnie)**, **stopień trudności (opcjonalnie)**, poszczególne składniki, kroki oraz **wskazówki**, zdjęcie, widoczność). Edycja odbywa się na ustrukturyzowanych danych, a nie na surowym tekście. Zmiana zdjęcia w edycji nie wymaga wybierania pliku z dysku — użytkownik może wkleić obraz ze schowka (Ctrl+V) lub przeciągnąć i upuścić plik na pole zdjęcia (z zachowaniem walidacji). Upload rozpoczyna się automatycznie po udanym paste/drop i pokazuje stan ładowania.
-   *Generowanie zdjęcia (AI, premium):* Użytkownik z rolą `premium` (lub `admin`) może w formularzu edycji wygenerować realistyczne zdjęcie potrawy na podstawie **aktualnego stanu formularza** (również niezapisanych zmian). Wygenerowane zdjęcie jest prezentowane jako podgląd i dopiero po akceptacji może zastąpić aktualne zdjęcie przepisu.
    - **Tryb 1 (bez zdjęcia):** jeśli w formularzu nie ma dostępnego zdjęcia (brak zdjęcia zapisango oraz brak zdjęcia wgranego/wklejonego w trakcie edycji), generowanie odbywa się wyłącznie na podstawie treści przepisu (jak dotychczas).
    - **Tryb 2 (z referencją zdjęcia):** jeśli w formularzu jest dostępne zdjęcie (zapisane w przepisie lub wgrane/wklejone w trakcie edycji), generowanie używa go jako **referencji wyglądu potrawy**. Zdjęcie referencyjne nie może zostać skopiowane: wygenerowana grafika ma być **całkowicie nową fotografią** z inną kompozycją, kątem i aranżacją.
    - **Informacja o trybie:** UI powinno czytelnie sygnalizować, w jakim trybie uruchomi się generowanie (np. tooltip przy przycisku AI).
    - **Parametry techniczne (MVP):** model `gpt-image-1.5`, wynik **`image/webp` 1024×1024** (parametry: `background=auto`, `quality=auto`, `n=1`).
-   *Usuwanie (Delete):* Użytkownik może usunąć swój przepis. Operacja wymaga potwierdzenia w oknie modalnym.
-   *Zarządzanie Widocznością:* Użytkownik może określić poziom widoczności przepisu:
    -   *Prywatny:* Widoczny tylko dla autora (domyślne).
    -   *Współdzielony:* Widoczny dla autora i połączonych użytkowników (przygotowanie pod przyszłą funkcjonalność).
    -   *Publiczny:* Widoczny dla wszystkich użytkowników.

-   *Importowanie (Import):* Użytkownik może dodać nowy przepis, wklejając tekst w predefiniowanym formacie Markdown. System automatycznie parsuje nazwę, sekcje składników i kroków, a następnie tworzy przepis, przenosząc użytkownika do widoku edycji w celu uzupełnienia dodatkowych danych (zdjęcie, kategoria, tagi).

-   *Asystowane dodawanie (AI):* Użytkownik może rozpocząć tworzenie przepisu w trybie „Z tekstu/zdjęcia (AI)”, gdzie wkleja tekst lub obraz przepisu. System wykorzystuje LLM (oraz OCR dla obrazu), aby wstępnie uzupełnić formularz danymi: tytuł, opis, składniki, kroki, **wskazówki (jeśli możliwe do wywnioskowania)**, kategoria i tagi. Jeśli dane wejściowe nie opisują pojedynczego przepisu, system wyświetla czytelny błąd i pozostaje na ekranie wklejania. Jeśli wejście jest puste, system otwiera pusty formularz.

-   *Składniki znormalizowane (backend, asynchronicznie):* Przy **każdym zapisie przepisu** (tworzenie i edycja) system automatycznie buduje i zapisuje (po stronie backendu) **listę składników znormalizowanych** na potrzeby przyszłej listy zakupów:
    -   *Źródło:* aktualna lista składników przepisu; normalizacja dotyczy wyłącznie elementów typu „pozycja” (linie), a **nagłówki sekcji** (`#...`) są ignorowane.
    -   *Format pojedynczego składnika znormalizowanego:* `nazwa` (liczba pojedyncza, mianownik), `ilosc` (liczba; opcjonalna), `jednostka` (opcjonalna; z listy kontrolowanej).
    -   *Jednostki (lista kontrolowana, MVP):* `g`, `ml`, `szt.`, `ząbek`, `łyżeczka`, `łyżka`, `szczypta`, `pęczek` (lista może zostać rozszerzona w przyszłości).
    -   *Konwersje jednostek:* przeliczenia wykonywane są **tylko** dla jednostek masy i objętości (np. `1 kg -> 1000 g`, `0,5 l -> 500 ml`).
    -   *Braki i niejednoznaczności:* jeśli w pozycji nie da się jednoznacznie określić ilości/jednostki (np. „do smaku”, „opcjonalnie”, „na oko”), system zapisuje **samą nazwę** (bez ilości i jednostki).
    -   *Sposób realizacji:* proces jest **asynchroniczny** (nie blokuje zapisu przepisu). W przypadku błędu system zachowuje dotychczasowy zapis przepisu oraz podejmuje ponowienie (retry) wg limitów kosztowych.
    -   *Kolejka jobów:* każdy zapis przepisu tworzy (lub odświeża) job w tabeli `normalized_ingredients_jobs` o statusie `PENDING`.
    -   *Deduplikacja (MVP):* w danym momencie może istnieć **maksymalnie 1 aktywny job na 1 przepis** (wg `recipe_id`). Kolejne zapisy przepisu:
        - nie tworzą „lawiny” jobów dla tego samego `recipe_id`,
        - powodują ponowne przeliczenie na **najnowszym stanie** przepisu.
    -   *Worker:* osobna **Supabase Edge Function** przetwarza joby `PENDING`/`RETRY` i:
        - wywołuje endpoint AI do normalizacji składników,
        - zapisuje wynik do `recipe_normalized_ingredients`,
        - aktualizuje status normalizacji w `recipes` (np. `PENDING/READY/FAILED`) oraz `normalized_ingredients_updated_at`.
    -   *Harmonogram:* worker jest uruchamiany jako **cron co 1 minutę**, ale realna częstotliwość przetwarzania jest sterowana przez zmienną środowiskową (w minutach), np. `NORMALIZED_INGREDIENTS_WORKER_RUN_EVERY_MINUTES`.
    -   *Retry policy (MVP):* maks. **5 prób** na job; backoff eksponencjalny z jitter (proponowane opóźnienia: **1m, 5m, 30m, 2h, 12h**). Po przekroczeniu limitu job przechodzi w `FAILED`.
    -   *Brak UI (MVP):* użytkownik nie widzi statusu/komunikatów tej normalizacji w interfejsie.

### 3.3. Organizacja przepisów
-   *Kategorie:* Użytkownik może przypisać przepis do jednej z predefiniowanych, stałych kategorii (np. obiad, deser, zupa).
-   *Tagi:* Użytkownik może dodawać do przepisu dowolną liczbę własnych tagów tekstowych (np. "wegetariańskie", "szybkie"). Interfejs pozwala na wpisanie tagu i zatwierdzenie go, co wizualizuje go jako "pigułkę".
-   *Kolekcje:* Użytkownik może tworzyć własne, nazwane zbiory przepisów (np. "Dania na święta", "Pomysły na lunch do pracy") i dodawać do nich istniejące przepisy.
-   *Mój plan (lista):* Zalogowany użytkownik może dodać dowolny przepis, do którego ma dostęp (własny lub publiczny innego autora), do swojej osobistej listy „Mój plan”:
    -   lista jest **trwała** (zapisana po stronie backendu) i dostępna po zalogowaniu na innym urządzeniu,
    -   lista jest **unikalna** (ten sam przepis może wystąpić maksymalnie raz),
    -   lista ma **limit 50** przepisów (bezpiecznik techniczny),
    -   użytkownik może przeglądać listę w formie wysuwanego panelu (drawer) oraz usuwać pojedyncze pozycje lub wyczyścić całą listę.

### 3.8. Zakupy (lista zakupów)
-   *Cel:* Zalogowany użytkownik może obsługiwać listę zakupów opartą o składniki do przepisów znajdujących się w „Moim planie”, z możliwością odhaczania posiadanych pozycji oraz dodawania własnych, ręcznych wpisów.
-   *Źródło danych (MVP):*
    -   pozycje „z przepisów” są budowane wyłącznie na podstawie **składników znormalizowanych** danego przepisu (`recipe_normalized_ingredients`),
    -   lista zakupów jest **trwała** (persistowana po stronie backendu) i powiązana z użytkownikiem,
    -   lista jest aktualizowana na zdarzeniach związanych z „Moim planem” (dodanie/usunięcie przepisu).
-   *Model danych listy zakupów (MVP):*
    -   backend przechowuje **każdy składnik każdego przepisu** jako **osobny wiersz** na liście zakupów (brak backendowej kumulacji/deduplikacji),
    -   każdy wiersz „z przepisu” zawiera co najmniej:
        -   `recipe_id` (ID przepisu z planu),
        -   `recipe_name` (snapshot nazwy przepisu w momencie dodania do planu),
        -   `nazwa`, `ilosc` (opcjonalnie), `jednostka` (opcjonalnie),
        -   `is_owned` (bool; stan „posiadane” zapisywany per wiersz),
    -   wiersze „ręczne” nie są powiązane z przepisem (np. `recipe_id = null`, `recipe_name = null`) i zawierają tekst użytkownika.
-   *Reguły prezentacji / grupowania (MVP, frontend):*
    -   **kumulacja i grupowanie wykonywane są na frontendzie** (nie w bazie i nie w API),
    -   frontend może grupować pozycje „z przepisów” wyłącznie wtedy, gdy mają identyczne:
        -   `nazwa`,
        -   `jednostka` (w tym przypadek `jednostka = null`),
        -   `is_owned` (aby uniknąć sytuacji „częściowo odhaczone”),
    -   dla pozycji zgrupowanych:
        -   jeśli `jednostka != null` i `ilosc != null`, ilości są sumowane,
        -   jeśli `jednostka = null` lub `ilosc = null`, pozycja jest prezentowana jako „tylko nazwa” (bez sumowania ilości),
    -   *Przykład:* jeśli w planie są przepisy z: `cukier 200 g` i `cukier 50 g` (obie pozycje `is_owned=false`), to frontend pokazuje: `cukier, 250 g`. Jeśli później użytkownik oznaczy tę pozycję jako `is_owned=true`, a następnie doda kolejny przepis z `cukier 10 g` (nowy wiersz ma domyślnie `is_owned=false`), frontend pokaże dwie pozycje: `cukier, 250 g` (posiadane) oraz `cukier, 10 g` (nieposiadane).
-   *Odhaczanie posiadanych:* Użytkownik może oznaczyć pozycję jako „posiadane”.
    -   pozycje oznaczone jako posiadane są **przesortowane na dół** listy oraz wizualnie zde-emfazyzowane (np. wyszarzone) (MVP),
    -   stan posiadania jest zapisywany per **wiersz** listy zakupów; w widoku zgrupowanym akcja „odhacz” dotyczy wszystkich wierszy w danej grupie (tj. ustawienia `is_owned` spójnie dla grupy).
-   *Usuwanie pozycji (MVP – rozszerzenie):*
    -   użytkownik może usuwać:
        -   pozycje **ręczne** (jak dotychczas),
        -   pozycje pochodzące **z przepisów**,
    -   ponieważ UI domyślnie prezentuje listę w formie **zgrupowanej**, usunięcie pozycji „z przepisu” usuwa **całą grupę** wierszy o identycznym kluczu grupowania: (`nazwa`, `jednostka`, `is_owned`) dla danego użytkownika,
    -   usunięcie pozycji „z przepisu” **nie modyfikuje** „Mojego planu” (nie usuwa przepisu z planu).
    -   usuwanie działa identycznie niezależnie od `is_owned` (można usuwać również pozycje oznaczone jako posiadane),
    -   po usunięciu użytkownik widzi potwierdzenie (Toast/Snackbar) z akcją **„Cofnij”** (Undo), która przywraca usunięte wiersze (dla całej grupy) w oknie czasowym,
    -   usunięcie jest trwałe po stronie backendu po finalizacji; po odświeżeniu widoku pozycja nie wraca,
    -   *Spójność z planem:* jeśli po usunięciu użytkownik doda do „Mojego planu” kolejny przepis, który wnosi taki sam składnik, pozycja może pojawić się ponownie (ponieważ są to nowe wiersze wynikające ze zmian w planie; nie utrzymujemy „wykluczeń” w MVP).
-   *Wyczyszczenie listy zakupów (MVP – rozszerzenie):*
    -   użytkownik może wyczyścić całą listę zakupów jednym przyciskiem,
    -   operacja usuwa **wszystkie wiersze** listy zakupów (zarówno „z przepisów”, jak i „ręczne”),
    -   operacja **nie modyfikuje** „Mojego planu” (lista przepisów w planie pozostaje bez zmian),
    -   po wyczyszczeniu lista zakupów pozostaje pusta do czasu:
        -   kolejnej zmiany w „Moim planie” (dodanie/usunięcie przepisu, które znów dopisze/usuwa wiersze),
        -   lub dodania nowej pozycji ręcznej przez użytkownika.
-   *Ręczne pozycje:* Użytkownik może dodać dowolną pozycję do listy zakupów niezwiązaną z żadnym przepisem jako **tekst** (bez dodatkowych pól ilości/jednostki).
    -   ręczne pozycje mogą być również oznaczane jako „posiadane” (jak powyżej),
    -   ręczne pozycje nie są automatycznie scalane z pozycjami znormalizowanymi (MVP).
-   *Spójność z planem:*
    -   dodanie przepisu do „Mojego planu” tworzy na liście zakupów **osobne wiersze** dla jego składników znormalizowanych (brak scalania po stronie backendu),
    -   usunięcie przepisu z „Mojego planu” usuwa z listy zakupów wszystkie wiersze powiązane z tym `recipe_id`,
    -   *Uwaga (MVP, świadome uproszczenie):* edycja przepisu, który jest już w planie, **nie powoduje automatycznej aktualizacji** listy zakupów (lista może stać się nieaktualna).

### 3.4. Wyszukiwanie i przeglądanie
-   *Wyszukiwanie:* Aplikacja posiada wyszukiwarkę tekstową, która przeszukuje nazwy przepisów, listę składników, **wskazówki** oraz przypisane tagi.
    -   *Minimalna długość frazy (MVP):* wyszukiwanie uruchamia się od **3 znaków** (po trim).
    -   *Semantyka wielowyrazowa (MVP):* fraza jest dzielona na tokeny (słowa) i traktowana jako **AND** (wszystkie tokeny muszą dopasować się w obrębie przeszukiwanych pól; szczegóły zależne od implementacji backendowej, ale zachowanie użytkowe ma być równoważne AND).
    -   *Dopasowanie tagów (MVP):* tagi dopasowują się jako **pełna nazwa** lub **prefix** (np. `weg` → `wege`).
    -   *Domyślna kolejność wyników (MVP):* sortowanie po **najlepszym dopasowaniu** (relevance) z priorytetem:
        -   dopasowanie w **nazwie** (najwyższy priorytet),
        -   dopasowanie w **składnikach** (średni priorytet),
        -   dopasowanie w **tagach**,
        -   dopasowanie w **wskazówkach** (najniższy priorytet).
        Technicznie: punktacja ważona **3/2/1/0.5** (nazwa/składniki/tagi/wskazówki) i sortowanie malejąco po wyniku; przy remisie sortowanie stabilne np. `created_at.desc`.
-   *Przeglądanie:* Użytkownicy mogą przeglądać listę "Moje przepisy", która zawiera:
    -   wszystkie przepisy zalogowanego użytkownika,
    -   oraz publiczne przepisy innych autorów dodane do co najmniej jednej kolekcji należącej do zalogowanego użytkownika (oznaczone jako "W moich kolekcjach").
    Dostępne są opcje sortowania (np. alfabetycznie, po dacie dodania) oraz filtrowania (po kategorii, po tagu, **po fladze "Termorobot"**, **po fladze "Grill"**).
-   *Szybki podgląd widoczności mojego przepisu na liście:* Jeśli na liście przepisów wyświetlany przepis jest mojego autorstwa, na jego karcie widzę ikonkę wskazującą aktualną wartość pola `visibility` (`Prywatny` / `Współdzielony` / `Publiczny`) wraz z krótkim tooltipem. Dla przepisów nie mojego autorstwa ikonka widoczności nie jest wyświetlana.
-   *Ładowanie wyników (zamiast paginacji):* Listy przepisów w widokach `/my-recipies` oraz `/explore` ładują wyniki porcjami: domyślnie **12** elementów, a kolejne są **doładowywane** przyciskiem **"Więcej"** (dopisywane pod już widocznymi). Przycisk znika, gdy nie ma więcej wyników.
-   *Lista przepisów kolekcji (bez paginacji w UI):* Widok `/collections/:id` ładuje i wyświetla od razu wszystkie przepisy przypisane do kolekcji (bez przycisku "Więcej" i bez klasycznej paginacji w UI). Po stronie API może istnieć **bezpieczny limit techniczny** (np. 500), a UI w razie przekroczenia limitu pokazuje czytelny komunikat.
-   *Stan pusty:* Dla nowych użytkowników, którzy nie mają jeszcze żadnych przepisów, wyświetlany jest przyjazny komunikat ("empty state") z zachętą do dodania pierwszej receptury.

### 3.5. Publiczny portal (dla niezalogowanych) i przeglądanie przepisów publicznych
-   *Cel:* Udostępnić wartościowy, bezpieczny content dla użytkowników niezalogowanych oraz umożliwić wyszukiwanie i przeglądanie **wyłącznie** przepisów o widoczności `Publiczny`.
-   *Landing z treściami:* Strona główna dla gości zawiera pole wyszukiwania oraz sekcje z kuratorowanym contentem (np. Najnowsze, Popularne, Sezonowe) bazujące na publicznych przepisach.
-   *Wyszukiwanie publiczne (MVP):* Gość może wyszukiwać publiczne przepisy **wyłącznie tekstowo** (bez filtrów) w oparciu o nazwę, składniki, tagi oraz **wskazówki**, z domyślnym sortowaniem po **najlepszym dopasowaniu** (priorytet: nazwa → składniki → tagi → wskazówki).
    -   *Pusta fraza:* przy pustej frazie (po trim) widok katalogu zachowuje się jak feed (np. sortowanie `created_at.desc`).
-   *Szczegóły przepisu publicznego:* Gość może wyświetlić pełne szczegóły publicznego przepisu (nazwa, opis, zdjęcie, składniki, kroki, **wskazówki (jeśli istnieją)**, kategoria, tagi) pod publiczną, kanoniczną ścieżką `/explore/recipes/:id-:slug` (np. `/explore/recipes/111-biala-kielbasa-z-jablkami`).
-   *Kompatybilność wsteczna i normalizacja:* Wejście na starszy URL bez sluga `/explore/recipes/:id` oraz wejście na URL z niepoprawnym slugiem powinno skutkować automatyczną normalizacją do kanonicznego adresu `/explore/recipes/:id-:slug` (redirect/replaceUrl).
-   *Spójność widoku szczegółów:* Widok szczegółów przepisu w części publicznej (`/explore/recipes/:id-:slug`) jest **tym samym widokiem merytorycznym** co widok szczegółów w części prywatnej (`/recipes/:id-:slug`) — różni się wyłącznie:
    -   brakiem wymogu logowania (brak ochrony routingu),
    -   brakiem Sidebara (inny layout dla ścieżek publicznych).
-   *Akcje zależne od kontekstu:* Akcje takie jak edycja/usuwanie są dostępne wyłącznie dla zalogowanego autora przepisu. Dla gościa oraz dla zalogowanego nie-autora pozostają niedostępne.
-   *Separacja od prywatnych zasobów:* Gość nie ma dostępu do przepisów `Prywatny` ani `Współdzielony`.
-   *Tryb zalogowanego na widokach publicznych:* Te same publiczne ścieżki (`/`, `/explore`, `/explore/recipes/:id-:slug`) są dostępne również dla użytkownika zalogowanego, ale interfejs dostosowuje się do jego kontekstu (z zachowaniem kompatybilności wstecznej dla `/explore/recipes/:id`, które normalizuje do kanonicznego URL):
    -   *Nawigacja:* Zamiast publicznego nagłówka z akcjami "Zaloguj / Zarejestruj", użytkownik widzi nawigację zalogowaną zgodną z App Shell (profil + możliwość przejścia do Dashboardu).
    -   *Brak CTA do logowania:* Na widokach publicznych dla zalogowanego nie wyświetla się przycisków "Zaloguj się" i "Zarejestruj się".
    -   *Akcje zalogowanego:* Na publicznym widoku szczegółów przepisu (gdy przepis nie jest jego) użytkownik może wykonać akcję "Dodaj do kolekcji" (zamiast CTA do rejestracji/logowania).
    -   *Oznaczenie własnych przepisów:* Na listach publicznych (landing/explore) przepisy, których autorem jest zalogowany użytkownik, są oznaczone jako "Twój przepis".
    -   *Zakres treści bez zmian:* Niezależnie od statusu logowania, widoki publiczne prezentują **wyłącznie** przepisy o widoczności `Publiczny`.

### 3.7. Kanoniczne URL-e przepisów (slug)
-   *Cel:* Ujednolicić udostępnialne linki do przepisów, poprawić czytelność i SEO oraz zapewnić kompatybilność wsteczną dla linków bez sluga.
-   *Zakres:* Dotyczy ścieżek:
    -   publicznej: `/explore/recipes/:id-:slug`,
    -   prywatnej: `/recipes/:id-:slug`.
-   *Kanoniczność:* Kanonicznym adresem jest zawsze wariant z `:id-:slug`. Warianty bez sluga (`/explore/recipes/:id`, `/recipes/:id`) oraz warianty z błędnym slugiem muszą być normalizowane do kanonicznego URL.
-   *Reguły generowania sluga (MVP):*
    -   slug jest generowany z nazwy przepisu (`recipes.name`),
    -   litery są zamieniane na lowercase,
    -   polskie znaki diakrytyczne są zamieniane na odpowiedniki bez znaków (np. `ą->a`, `ć->c`, `ę->e`, `ł->l`, `ń->n`, `ó->o`, `ś->s`, `ż->z`, `ź->z`),
    -   znaki niealfanumeryczne są usuwane/zamieniane na separator, a separatory są normalizowane do pojedynczego `-`,
    -   wielokrotne myślniki są zwijane, a myślniki na początku i końcu są usuwane,
    -   obowiązuje limit długości sluga (np. **80** znaków),
    -   jeśli po normalizacji slug jest pusty, stosowany jest bezpieczny fallback (np. `przepis`).
-   *Zachowanie przy zmianie nazwy przepisu:* slug jest wyznaczany na podstawie **aktualnej** nazwy przepisu; wejście na nieaktualny URL powinno zostać znormalizowane do bieżącego kanonicznego adresu.

### 3.6. Standardy Interfejsu i Nawigacji (App Shell)
-   *Architektura App Shell:* Aplikacja dla zalogowanych użytkowników musi posiadać stałą ramę (Shell) składającą się z paska bocznego (nawigacja główna) i paska górnego (kontekst).
-   *Widoczność Sidebara:* Sidebar jest widoczny **wyłącznie** w prywatnych sekcjach aplikacji: `/dashboard`, `/my-recipies` (alias: `/my-recipes`), `/recipes/**`, `/collections/**`, `/settings/**`. Na pozostałych ścieżkach (np. publiczne: `/`, `/explore`, auth: `/login`, `/register`) Sidebar nie jest wyświetlany.
-   *Główna nawigacja w Topbarze:* Topbar zawiera **stałą** (niezależną od widoku) główną nawigację aplikacji z co najmniej dwoma pozycjami: `Moja Pycha` (`/dashboard`) oraz `Odkrywaj przepisy` (`/explore`). Aktywna pozycja jest zawsze wyróżniona.
-   *Konfiguracja nawigacji:* Pozycje głównej nawigacji są **zahardkodowane we froncie** (konfiguracja statyczna w aplikacji Angular). API nie dostarcza konfiguracji menu w MVP.
-   *Separacja Akcji:* Przyciski nawigacyjne ("Idź do...") są odseparowane od przycisków akcji ("Zrób coś..."). Akcje kontekstowe dla danego widoku znajdują się zawsze w dedykowanym nagłówku strony (Page Header).
-   *Feedback Użytkownika:* Operacje zapisu, edycji i usuwania muszą być potwierdzane komunikatami typu "Toast" (Snackbar) z możliwością cofnięcia akcji (Undo).
-   *Kolekcje jako drzewo w Sidebarze (MVP):*
    -   pozycja główna **„Kolekcje”** w Sidebarze jest rozwijalna (chevron) i pokazuje listę kolekcji użytkownika jako podpozycje,
    -   kliknięcie w etykietę „Kolekcje” prowadzi do widoku zarządzania kolekcjami (`/collections`) (lista kolekcji),
    -   kliknięcie w chevron obok „Kolekcje” zwija/rozwija drzewo (bez nawigacji),
    -   każda kolekcja (poziom 2) jest rozwijalna i po rozwinięciu pokazuje listę przepisów należących do tej kolekcji (poziom 3),
    -   lista przepisów kolekcji w Sidebarze ładuje się **leniwe** (dopiero po rozwinięciu danej kolekcji),
    -   wpis przepisu (poziom 3) pokazuje **nazwę** oraz **małą miniaturę** z ilustracji przepisu (jeśli przepis ma zdjęcie),
    -   kliknięcie w przepis ładuje widok szczegółów przepisu w kontencie pod kanoniczną ścieżką `/recipes/:id-:slug`,
    -   drzewo kolekcji można zwijać i rozwijać analogicznie jak główne pozycje menu.

## 4. Granice produktu

Następujące funkcjonalności są celowo pominięte w wersji MVP, aby uprościć wdrożenie i skupić się na kluczowej wartości produktu. Mogą zostać wdrożone w przyszłości.

-   *Funkcje oparte na AI/LLM (poza zakresem MVP):* Automatyczne importowanie przepisów z linków, modyfikacja przepisów (zmiana porcji, zamienniki składników), generowanie ciekawostek czy automatyczne planowanie posiłków.
    -   **Wyjątek (w zakresie MVP):** Asystowane dodawanie przepisu z wklejonego tekstu lub obrazu (OCR) z użyciem LLM, które **wstępnie wypełnia formularz przepisu** (tytuł/opis/składniki/kroki/kategoria/tagi), a użytkownik finalnie weryfikuje i zapisuje dane.
-   *Zarządzanie spiżarnią:* Moduł do śledzenia domowych zapasów (pantry) i automatyzacji na tej podstawie.
-   *Funkcje społecznościowe:* Dzielenie się przepisami z innymi użytkownikami, system "znajomych", publiczne profile, komentowanie czy ocenianie.
-   *Zaawansowane atrybuty przepisów:* Pola takie jak wartości odżywcze, szczegółowa lista wymaganego sprzętu.
    -   **Uwaga (nowe metadane w MVP):** pola klasyfikacyjne przepisu: typ diety (Mięso/Wege/Vegan), kuchnia (lista kontrolowana) oraz stopień trudności (Łatwe/Średnie/Trudne) są w zakresie MVP i służą do organizacji/przeglądu w szczegółach przepisu.
-   *Zaawansowane wersjonowanie i edycja:* Mechanizm "przeciągnij i upuść" do zmiany kolejności kroków/składników, historia zmian przepisu.
-   *Rozbudowany panel administracyjny:* Kompleksowy panel do zarządzania aplikacją. Początkowe zadania administracyjne będą wykonywane bezpośrednio w bazie danych.
-   *Zarządzanie rolami w aplikacji:* W MVP nie ma ekranu ani przepływu do nadawania/zmiany ról użytkowników. Funkcjonalność jest przygotowana infrastrukturalnie (rola w JWT), a operacje administracyjne wykonywane są bezpośrednio w bazie danych.

## 5. Historyjki użytkowników

---
-   *ID:* US-001
-   *Tytuł:* Rejestracja nowego użytkownika
-   *Opis:* Jako nowy użytkownik, chcę móc stworzyć konto w aplikacji, podając swój adres e-mail, nazwę użytkownika, hasło i potwierdzenie hasła, abym mógł bezpiecznie przechowywać swoje prywatne przepisy.
-   *Kryteria akceptacji:*
    1.  Formularz rejestracji zawiera pola na adres e-mail, nazwę użytkownika, hasło oraz potwierdzenie hasła.
    2.  System waliduje poprawność formatu adresu e-mail.
    3.  System wymaga, aby hasło miało minimalną, określoną długość.
    4.  System waliduje czy hasło i potwierdzenie hasła są identyczne.
    5.  Po pomyślnej rejestracji system **wysyła link weryfikacyjny** na podany adres e-mail.
    6.  Po wysłaniu linku system wyświetla widok/komunikat: „Wysłaliśmy link aktywacyjny na adres: {email}”.
    7.  Użytkownik **nie jest automatycznie logowany** po rejestracji.
    8.  Użytkownik **nie może się zalogować** do momentu potwierdzenia adresu e-mail.
    9.  Kliknięcie w link weryfikacyjny powoduje potwierdzenie e-maila w systemie i prezentację komunikatu: „Adres e-mail potwierdzony. Możesz się zalogować.”
    10. W przypadku, gdy konto o podanym adresie e-mail już istnieje:
        - jeśli konto jest zweryfikowane: wyświetlany jest komunikat „Konto już istnieje” oraz link do logowania/resetu hasła,
        - jeśli konto nie jest zweryfikowane: system umożliwia ponowne wysłanie linku weryfikacyjnego (z ograniczeniem częstotliwości).

---
-   *ID:* US-002
-   *Tytuł:* Logowanie i wylogowywanie użytkownika
-   *Opis:* Jako zarejestrowany użytkownik, chcę móc zalogować się na swoje konto za pomocą e-maila i hasła, aby uzyskać dostęp do moich przepisów. Chcę również mieć możliwość wylogowania się.
-   *Kryteria akceptacji:*
    1.  Formularz logowania zawiera pola na adres e-mail i hasło.
    2.  Po poprawnym wprowadzeniu danych, użytkownik jest zalogowany i ma dostęp do swoich zasobów.
    3.  W przypadku podania błędnych danych, wyświetlany jest komunikat o nieprawidłowym loginie lub haśle.
    4.  Zalogowany użytkownik widzi w interfejsie opcję "Wyloguj".
    5.  Kliknięcie "Wyloguj" kończy sesję użytkownika i przekierowuje go na stronę główną dla niezalogowanych.
    6.  Jeśli użytkownik próbuje się zalogować, a jego e-mail nie jest potwierdzony, system blokuje logowanie i wyświetla komunikat: „Potwierdź adres e-mail, aby się zalogować” oraz akcję „Wyślij link ponownie” (z ograniczeniem częstotliwości).

---
-   *ID:* US-035
-   *Tytuł:* Odczyt roli zalogowanego użytkownika (RBAC – przygotowanie)
-   *Opis:* Jako właściciel produktu, chcę móc odczytać rolę zalogowanego użytkownika, aby w przyszłości udostępniać wybrane funkcje tylko określonym rolom (np. premium/admin).
-   *Kryteria akceptacji:*
    1.  System definiuje role aplikacyjne jako enum: `user`, `premium`, `admin`. Użytkownik ma dokładnie jedną rolę.
    2.  Nowo utworzone konto otrzymuje rolę domyślną `user`.
    3.  Po zalogowaniu JWT zawiera claim z rolą aplikacyjną (np. `app_role`), możliwy do odczytania po stronie klienta.
    4.  Rola nie jest nadawana ani zmieniana z poziomu UI w MVP.
    5.  Jeśli rola jest nieustawiona lub ma nieznaną wartość, system traktuje to jako stan nieprawidłowy i stosuje bezpieczny fallback (np. zachowanie jak dla `user` po stronie UI) oraz umożliwia dalsze diagnozowanie (np. logowanie techniczne).

---
-   *ID:* US-033
-   *Tytuł:* Ponowna wysyłka linku weryfikacyjnego e-mail
-   *Opis:* Jako użytkownik, który nie otrzymał wiadomości z linkiem weryfikacyjnym lub link wygasł, chcę móc wysłać link ponownie, aby dokończyć rejestrację.
-   *Kryteria akceptacji:*
    1.  Na ekranie „Wysłaliśmy link aktywacyjny” widoczna jest akcja „Wyślij ponownie”.
    2.  Akcja „Wyślij ponownie” posiada cooldown **60 sekund** i jest zablokowana w trakcie odliczania.
    3.  Po poprawnym wysłaniu system pokazuje potwierdzenie (Toast/Snackbar) i resetuje odliczanie.
    4.  System posiada techniczny limit nadużyć (np. limit dzienny) i w razie przekroczenia wyświetla czytelny komunikat.

---
-   *ID:* US-034
-   *Tytuł:* Obsługa nieważnego lub wygasłego linku weryfikacyjnego
-   *Opis:* Jako użytkownik, chcę zobaczyć jasny komunikat, gdy link weryfikacyjny jest nieważny lub wygasł, oraz móc poprosić o nowy link, abym mógł aktywować konto.
-   *Kryteria akceptacji:*
    1.  Po wejściu z nieważnym/wygasłym linkiem system wyświetla komunikat: „Link nieważny lub wygasł”.
    2.  Użytkownik ma możliwość wysłania nowego linku weryfikacyjnego z tego ekranu (z ograniczeniem częstotliwości).
    3.  System nie ujawnia dodatkowych informacji wrażliwych (np. czy e-mail istnieje) w scenariuszach, gdzie mogłoby to ułatwiać enumerację kont.

---
-   *ID:* US-003
-   *Tytuł:* Dodawanie nowego przepisu
-   *Opis:* Jako użytkownik, chcę dodać nowy przepis do mojej cyfrowej książki kucharskiej, wypełniając prosty formularz, abym mógł zdigitalizować moje receptury.
-   *Kryteria akceptacji:*
    1.  Formularz dodawania przepisu zawiera pola na: nazwę (tekst), opis (tekst), **liczba porcji (opcjonalnie)**, **czas przygotowania (opcjonalnie, w minutach)**, **czas całkowity (opcjonalnie, w minutach)**, **flaga "Termorobot" (checkbox/toggle, opcjonalnie, domyślnie wyłączona)**, **flaga "Grill" (checkbox/toggle, opcjonalnie, domyślnie wyłączona)**, **typ diety (opcjonalnie: Mięso / Wege / Vegan)**, **kuchnia (opcjonalnie; lista kontrolowana)**, **stopień trudności (opcjonalnie: Łatwe / Średnie / Trudne)**, zdjęcie (przesyłanie pliku), składniki (`textarea`), kroki (`textarea`), **wskazówki (`textarea`, opcjonalnie)**.
    2.  Pola nazwa, składniki i kroki są wymagane.
    3.  Tekst wklejony w pole "składniki" jest dzielony na poszczególne pozycje według znaków nowej linii.
    4.  Tekst wklejony w pole "kroki" jest dzielony na poszczególne pozycje według znaków nowej linii. System automatycznie usuwa istniejącą ręczną numerację (np. "1. ", "2) ") z początku linii, aby zapewnić spójne wyświetlanie w widoku szczegółów.
    5.  Tekst wklejony w pole "wskazówki" jest dzielony na poszczególne pozycje według znaków nowej linii (analogicznie do składników).
    6.  Linie w polach "składniki", "kroki" oraz "wskazówki", które zaczynają się od `#`, są traktowane jako nagłówki sekcji.
    7.  Po pomyślnym zapisaniu formularza, jestem przekierowany na stronę nowo utworzonego przepisu.

---
-   *ID:* US-004
-   *Tytuł:* Przeglądanie szczegółów przepisu
-   *Opis:* Jako użytkownik, chcę móc wyświetlić pełne szczegóły zapisanego przepisu w czytelnym układzie, abym mógł z niego wygodnie korzystać podczas gotowania.
-   *Kryteria akceptacji:*
    1.  Na stronie przepisu widoczne są: nazwa, opis, zdjęcie, lista składników, lista kroków oraz (jeśli istnieją) **wskazówki**.
    2.  Na widoku desktopowym składniki i kroki są wyświetlane obok siebie w dwóch kolumnach.
    3.  Jeśli składniki lub kroki posiadają sekcje, są one wyraźnie oddzielone nagłówkami.
    4.  Lista kroków jest wyświetlana jako numerowana lista. Numeracja jest ciągła dla całego przepisu i nie resetuje się po nagłówkach sekcji.
    5.  Przesłane zdjęcie jest automatycznie skalowane i przycinane, aby pasowało do wyznaczonego kontenera.
    6.  Na stronie przepisu widoczne są również przypisane kategorie i tagi.
    7.  Jako właściciel przepisu, widzę przyciski "Edytuj" i "Usuń".
    8.  Jako zalogowany nie-właściciel przepisu, nie widzę przycisków "Edytuj" i "Usuń" (niezależnie od tego, skąd wszedłem w szczegóły przepisu, np. z listy "Moje przepisy").
    9.  Jeśli przepis ma uzupełnioną liczbę porcji, jest ona wyświetlana bezpośrednio pod tytułem przepisu w formacie z poprawną odmianą (np. `1 porcja`, `2 porcje`, `5 porcji`).
    10. Jeśli przepis ma uzupełniony czas przygotowania, jest on wyświetlany **pod opisem** jako metadana z ikonką (np. `schedule`) i wartością sformatowaną (np. `45 min`, `1 h 20 min`).
    11. Jeśli przepis ma uzupełniony czas całkowity, jest on wyświetlany **pod opisem** jako metadana z ikonką (np. `timer`) i wartością sformatowaną (np. `1 h 45 min`).
    12. Jeśli dana wartość czasu nie jest ustawiona, odpowiadająca jej metadana nie jest wyświetlana.
    13. Jeśli przepis ma uzupełniony **typ diety**, **kuchnię** lub **stopień trudności**, wartości te są widoczne w szczegółach jako czytelne metadane (np. chipy/badge) w przewidywalnym miejscu obok innych metadanych przepisu.
    14. Jeśli dane pole klasyfikacyjne nie jest ustawione, odpowiadająca mu metadana nie jest wyświetlana.
    15. Jeśli przepis ma włączoną flagę **"Grill"**, w szczegółach widoczna jest metadana w postaci ikonki grilla oraz etykiety **„Grill”** (np. chip/badge).
    16. Jeśli przepis ma uzupełnione wskazówki, są one widoczne jako osobna sekcja **pod listą kroków przygotowania**.
    17. Jeśli przepis nie ma żadnych wskazówek (pusta lista), sekcja wskazówek nie jest wyświetlana.

---
-   *ID:* US-005
-   *Tytuł:* Edycja istniejącego przepisu
-   *Opis:* Jako użytkownik, chcę mieć możliwość edytowania każdego elementu mojego przepisu, aby móc poprawić błędy lub wprowadzić modyfikacje.
-   *Kryteria akceptacji:*
    1.  Po kliknięciu przycisku "Edytuj" na stronie przepisu, zostaję przeniesiony do formularza edycji.
    2.  Formularz jest wstępnie wypełniony aktualnymi danymi przepisu.
    3.  Mogę edytować nazwę i opis.
    4.  Mogę zmienić zdjęcie przepisu na jeden z trzech sposobów:
        -   wybór pliku z dysku (fallback),
        -   wklejenie obrazu ze schowka (Ctrl+V), gdy fokus jest na polu zdjęcia,
        -   przeciągnięcie i upuszczenie pliku na pole zdjęcia.
    5.  System akceptuje wyłącznie formaty `image/png`, `image/jpeg`, `image/webp` oraz rozmiar do `10 MB`. Dla innych typów/rozmiarów wyświetlany jest czytelny komunikat błędu i zdjęcie nie jest zmieniane.
    6.  Po wklejeniu/upuszczeniu obrazu upload rozpoczyna się automatycznie (bez klikania "Zapisz") i widoczny jest stan ładowania/progres.
    7.  Po poprawnym przesłaniu widzę natychmiastowy podgląd nowego zdjęcia.
    8.  Do czasu zapisania przepisu mogę cofnąć zmianę zdjęcia (akcja "Cofnij"/Undo w Snackbarze).
    9.  Mogę usunąć zdjęcie przepisu (ustawić brak zdjęcia) i zapisać zmianę.
    10. Mogę edytować tekst każdego składnika, kroku oraz wskazówki indywidualnie, dodawać nowe oraz usuwać istniejące.
    11. Po zapisaniu zmian, jestem przekierowywany z powrotem na stronę zaktualizowanego przepisu.
    12. Mogę opcjonalnie ustawić liczbę porcji jako liczbę całkowitą w zakresie `1-99`.
    13. Mogę wyczyścić pole liczby porcji (ustawić brak wartości) i zapisać zmianę.
    14. Mogę opcjonalnie ustawić czas przygotowania jako liczbę całkowitą minut w zakresie `0-999`.
    15. Mogę opcjonalnie ustawić czas całkowity jako liczbę całkowitą minut w zakresie `0-999`.
    16. Mogę wyczyścić pole czasu przygotowania lub czasu całkowitego (ustawić brak wartości) i zapisać zmianę.
    17. Jeśli oba czasy są ustawione, system wymaga aby `czas całkowity >= czas przygotowania`. W przeciwnym razie zapis jest blokowany i widzę czytelny błąd walidacji.
    18. Mogę oznaczyć przepis jako **"Termorobot"** (włączyć/wyłączyć flagę) i zapisać zmianę.
    19. Po ponownym wejściu w edycję widzę aktualnie zapisaną wartość flagi "Termorobot".
    20. Mogę opcjonalnie ustawić typ diety jako jedną z wartości: `Mięso` / `Wege` / `Vegan`.
    21. Mogę opcjonalnie ustawić kuchnię jako jedną z wartości z listy kontrolowanej (np. `Polska`, `Azjatycka`, `Meksykańska`, `Bliskowschodnia`).
    22. Mogę opcjonalnie ustawić stopień trudności jako jedną z wartości: `Łatwe` / `Średnie` / `Trudne`.
    23. Mogę wyczyścić każde z powyższych pól (ustawić brak wartości) i zapisać zmianę.
    24. Mogę oznaczyć przepis jako **"Grill"** (włączyć/wyłączyć flagę) i zapisać zmianę.
    25. Po ponownym wejściu w edycję widzę aktualnie zapisaną wartość flagi "Grill".

---
-   *ID:* US-047
-   *Tytuł:* Automatyczne tworzenie składników znormalizowanych przy zapisie przepisu
-   *Opis:* Jako użytkownik, chcę aby system automatycznie tworzył i aktualizował listę składników znormalizowanych przy zapisie przepisu, abym w przyszłości mógł budować listę zakupów bez zmiany sposobu wpisywania składników.
-   *Kryteria akceptacji:*
    1.  Przy `Dodawaniu nowego przepisu` oraz `Edycji istniejącego przepisu` system uruchamia proces normalizacji składników.
    2.  Proces normalizacji **nie blokuje** zapisu przepisu (zapis przepisu kończy się sukcesem niezależnie od wyniku normalizacji).
    3.  Normalizacja bazuje na aktualnym stanie składników przepisu i obejmuje wyłącznie pozycje składników (elementy listy), ignorując nagłówki sekcji (`#...`).
    4.  Każdy znormalizowany składnik ma pola: `nazwa` (w liczbie pojedynczej, mianownik), `ilosc` (liczba; opcjonalnie), `jednostka` (opcjonalnie; z listy kontrolowanej).
    5.  Dozwolone jednostki (MVP) obejmują: `g`, `ml`, `szt.`, `ząbek`, `łyżeczka`, `łyżka`, `szczypta`, `pęczek`.
    6.  System przelicza jednostki **tylko** w obrębie masy i objętości (np. `kg -> g`, `l -> ml`). Dla pozostałych przypadków pozostawia jednostkę typu `łyżeczka/łyżka/szczypta` albo brak jednostki.
    7.  Jeśli ilości/jednostki nie da się pewnie ustalić (np. „do smaku”, „opcjonalnie”, „na oko”), system zapisuje składnik znormalizowany zawierający **tylko nazwę**.
    8.  Znormalizowane składniki są zapisywane po stronie backendu i są dostępne wyłącznie dla właściciela przepisu (zgodnie z RLS).
    9.  Dotychczasowa obsługa „zwykłych” składników (lista w przepisie, wyszukiwanie tekstowe po składnikach) działa bez zmian.
    10. W przypadku błędu normalizacji system nie pokazuje błędu użytkownikowi w UI (MVP) i może ponowić próbę w tle zgodnie z limitami kosztów.

---
-   *ID:* US-048
-   *Tytuł:* Niezawodny worker normalizacji składników (cron + retry + deduplikacja)
-   *Opis:* Jako właściciel produktu, chcę aby system miał niezawodny worker przetwarzający kolejkę normalizacji składników, aby normalizacja działała w tle bez blokowania zapisu, a błędy były automatycznie ponawiane.
-   *Kryteria akceptacji:*
    1.  Każdy zapis przepisu (create/update) tworzy lub odświeża job normalizacji składników w tabeli `normalized_ingredients_jobs` ze statusem `PENDING`.
    2.  System zapewnia deduplikację: w danym momencie istnieje maksymalnie **1 aktywny job** dla danego `recipe_id`.
    3.  Worker jest uruchamiany jako cron co 1 minutę, ale faktyczne uruchamianie przetwarzania jest sterowane zmienną środowiskową w minutach (np. `NORMALIZED_INGREDIENTS_WORKER_RUN_EVERY_MINUTES`).
    4.  Worker pobiera joby gotowe do wykonania (`PENDING`/`RETRY`) i przetwarza je w sposób bezpieczny współbieżnie (brak podwójnego przetwarzania tego samego joba).
    5.  W przypadku błędu normalizacji, job przechodzi w stan retry i jest ponawiany maksymalnie **5 razy** z backoff (1m, 5m, 30m, 2h, 12h) oraz jitter.
    6.  Po przekroczeniu limitu prób job przechodzi w stan `FAILED`, a przepis pozostaje zapisany bez blokowania wcześniejszego zapisu.
    7.  Po sukcesie normalizacji system zapisuje wynik do `recipe_normalized_ingredients` oraz aktualizuje status w `recipes` (np. `READY` + `normalized_ingredients_updated_at`).
    8.  System nie pokazuje użytkownikowi żadnych komunikatów związanych z tą normalizacją w UI (MVP).

---

-   *ID:* US-049
-   *Tytuł:* Automatyczna lista zakupów na podstawie „Mojego planu”
-   *Opis:* Jako zalogowany użytkownik, chcę aby dodanie przepisu do „Mojego planu” automatycznie dodawało jego składniki znormalizowane do listy zakupów, abym nie musiał ręcznie przepisywać składników.
-   *Kryteria akceptacji:*
    1.  Po dodaniu przepisu do „Mojego planu” na liście zakupów pojawiają się pozycje odpowiadające `recipe_normalized_ingredients` tego przepisu.
    2.  System tworzy **osobne wiersze** listy zakupów dla każdego składnika znormalizowanego danego przepisu (brak backendowego scalania/deduplikacji).
    3.  Każdy wiersz „z przepisu” zawiera `recipe_id` oraz `recipe_name` (snapshot nazwy przepisu w momencie dodania do planu).
    4.  Nowo utworzone wiersze „z przepisu” mają domyślnie `is_owned=false`.
    5.  System nie scala ręcznych pozycji użytkownika z pozycjami z przepisów (MVP).

---
-   *ID:* US-050
-   *Tytuł:* Aktualizacja listy zakupów przy usuwaniu przepisu z planu
-   *Opis:* Jako zalogowany użytkownik, chcę aby usunięcie przepisu z „Mojego planu” usuwało z listy zakupów odpowiadające mu ilości składników, abym lista odzwierciedlała aktualny plan.
-   *Kryteria akceptacji:*
    1.  Po usunięciu przepisu z planu system usuwa z listy zakupów wszystkie wiersze „z przepisu” powiązane z tym `recipe_id`.
    2.  Ręczne pozycje dodane przez użytkownika nie są usuwane ani modyfikowane przez operację usuwania przepisu z planu.

---
-   *ID:* US-051
-   *Tytuł:* Odhaczanie posiadanych pozycji na liście zakupów
-   *Opis:* Jako użytkownik, chcę oznaczać które pozycje z listy zakupów już posiadam, aby łatwiej skupić się na tym co muszę kupić.
-   *Kryteria akceptacji:*
    1.  Każda pozycja listy zakupów ma kontrolkę pozwalającą oznaczyć ją jako „posiadane”.
    2.  Pozycje oznaczone jako posiadane są przesortowane na dół listy oraz wizualnie zde-emfazyzowane (np. wyszarzone).
    3.  Stan „posiadane” jest zapisywany i odtwarzany po ponownym wejściu na widok „Zakupy” (per wiersz; w widoku zgrupowanym odhaczanie dotyczy wszystkich wierszy w danej grupie).
    4.  Frontend grupuje pozycje „z przepisów” tylko jeśli mają identyczne (`nazwa`, `jednostka`, `is_owned`). Jeśli identyczne składniki mają różne `is_owned`, są prezentowane jako osobne pozycje (brak grupowania).

---
-   *ID:* US-052
-   *Tytuł:* Dodawanie ręcznych pozycji do listy zakupów
-   *Opis:* Jako użytkownik, chcę dodać własny wpis tekstowy do listy zakupów niezwiązany z żadnym przepisem, abym mógł dopisać rzeczy typu „papier toaletowy”.
-   *Kryteria akceptacji:*
    1.  Na widoku „Zakupy” dostępne jest pole tekstowe do wpisania nowej pozycji oraz akcja „Dodaj”.
    2.  Po dodaniu wpis pojawia się na liście zakupów jako ręczna pozycja.
    3.  Ręczne pozycje mogą być oznaczane jako „posiadane” (tak jak pozycje z przepisów).
    4.  Ręczne pozycje mogą zostać usunięte przez użytkownika (MVP).

---
-   *ID:* US-053
-   *Tytuł:* Usuwanie pojedynczej pozycji z listy zakupów pochodzącej z przepisu
-   *Opis:* Jako użytkownik, chcę usunąć pojedynczą pozycję z listy zakupów, nawet jeśli pochodzi ze składników przepisu w „Moim planie”, abym mógł dopasować listę do realnych potrzeb bez usuwania całego przepisu z planu.
-   *Kryteria akceptacji:*
    1.  Na widoku „Zakupy” każda pozycja pochodząca z przepisów ma dostępną akcję usunięcia (ikonka kosza), analogicznie jak pozycja ręczna.
    2.  Ponieważ widok domyślnie prezentuje pozycje „z przepisów” w formie zgrupowanej, usunięcie usuwa całą grupę wierszy odpowiadających kluczowi (`nazwa`, `jednostka`, `is_owned`) dla zalogowanego użytkownika.
    3.  Operacja usunięcia pozycji „z przepisu” **nie usuwa** żadnego przepisu z „Mojego planu” i nie modyfikuje planu.
    4.  Po usunięciu użytkownik widzi potwierdzenie (Toast/Snackbar) z akcją **„Cofnij”** (Undo); jeśli użytkownik kliknie „Cofnij” w oknie czasowym, usunięcie nie jest finalizowane.
    5.  Operacja jest trwała po stronie backendu (po finalizacji) i po odświeżeniu widoku pozycja nie wraca.
    6.  Usuwanie działa również dla pozycji oznaczonych jako „posiadane” (`is_owned=true`) i usuwa odpowiednią grupę dla danego stanu.
    7.  Jeśli po usunięciu użytkownik doda do planu nowy przepis generujący ten sam składnik, pozycja może pojawić się ponownie jako nowe wiersze wynikające ze zmiany w planie.

---
-   *ID:* US-054
-   *Tytuł:* Wyczyść listę zakupów bez modyfikacji „Mojego planu”
-   *Opis:* Jako użytkownik, chcę jednym przyciskiem wyczyścić całą listę zakupów, abym mógł zacząć od zera bez usuwania przepisów z „Mojego planu”.
-   *Kryteria akceptacji:*
    1.  Na widoku „Zakupy” dostępna jest akcja „Wyczyść listę” w przewidywalnym miejscu (nagłówek strony / Page Header).
    2.  Kliknięcie akcji otwiera modal potwierdzenia z jasną informacją, że operacja:
        - usuwa wszystkie pozycje z listy zakupów,
        - nie usuwa przepisów z „Mojego planu”.
    3.  Po potwierdzeniu system usuwa wszystkie wiersze listy zakupów użytkownika (pozycje ręczne i z przepisów).
    4.  Po sukcesie widok pokazuje pustą listę oraz potwierdzenie (Toast/Snackbar).
    5.  Operacja nie posiada akcji Undo (cofnięcia) w MVP.
-   *ID:* US-045
-   *Tytuł:* Dodawanie i edycja wskazówek do przepisu
-   *Opis:* Jako autor przepisu, chcę móc dodać i edytować listę wskazówek (tipów) powiązanych z przepisem, aby zapisać ważne uwagi, warianty i „patenty” do wykorzystania przy kolejnych przygotowaniach.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępna jest sekcja **„Wskazówki”** analogiczna do sekcji składników (lista edytowalna).
    2.  Sekcja „Wskazówki” jest **opcjonalna** – przepis może zostać zapisany bez żadnej wskazówki.
    3.  Mogę dodać nową wskazówkę, edytować jej treść oraz usunąć istniejącą wskazówkę.
    4.  Wskazówki wspierają nagłówki sekcji: linie zaczynające się od `#` są traktowane jako nagłówki (analogicznie do składników i kroków).
    5.  W widoku szczegółów przepisu wskazówki (jeśli istnieją) są wyświetlane jako osobna sekcja **pod listą kroków przygotowania**.
    6.  Jeśli lista wskazówek jest pusta, sekcja wskazówek nie jest wyświetlana w szczegółach.

---
-   *ID:* US-027
-   *Tytuł:* Szybka zmiana zdjęcia przepisu przez wklejenie lub przeciągnięcie (edycja)
-   *Opis:* Jako użytkownik edytujący przepis, chcę wkleić obraz ze schowka lub przeciągnąć plik na pole zdjęcia, aby szybko zaktualizować zdjęcie bez szukania pliku w systemie.
-   *Kryteria akceptacji:*
    1.  Na formularzu edycji widzę wyraźne pole/strefę zdjęcia z instrukcją "Wklej (Ctrl+V) lub przeciągnij plik" oraz linkiem/przyciskiem "Wybierz plik" jako fallback.
    2.  Pole zdjęcia reaguje wizualnie na `dragover` (stan aktywny) i odrzuca drop, jeśli dane nie zawierają pliku obrazu.
    3.  Wklejenie (Ctrl+V) działa, gdy pole zdjęcia jest fokusowane (klawiaturą lub kliknięciem). Jeśli w schowku nie ma obrazu, system pokazuje komunikat i nie zmienia zdjęcia.
    4.  System waliduje typ i rozmiar pliku zgodnie z ograniczeniami: PNG/JPG/WebP, max 10 MB.
    5.  Upload startuje automatycznie po udanym paste/drop. W trakcie uploadu użytkownik widzi stan ładowania, a akcje zapisu są odpowiednio zablokowane lub użytkownik otrzymuje jasny komunikat o trwającym przesyłaniu.
    6.  Po sukcesie system aktualizuje podgląd zdjęcia i pokazuje potwierdzenie (Toast/Snackbar) z akcją "Cofnij" działającą do czasu zapisu przepisu.
    7.  W przypadku błędu uploadu (np. sieć, brak uprawnień) system pokazuje czytelny błąd i pozostawia poprzednie zdjęcie bez zmian.

---
-   *ID:* US-037
-   *Tytuł:* Generowanie zdjęcia przepisu (AI) w edycji – tylko premium
-   *Opis:* Jako użytkownik `premium`, chcę jednym kliknięciem wygenerować realistyczne zdjęcie potrawy dla aktualnie edytowanego przepisu, aby szybko uzyskać atrakcyjną ilustrację bez szukania zdjęć w internecie.
-   *Kryteria akceptacji:*
    1.  W formularzu edycji przepisu, obok pola zdjęcia, widzę przycisk z ikoną **AI** (np. w formie ikonki/akcji przy polu).
    2.  Przycisk jest widoczny i aktywny wyłącznie dla użytkowników z rolą `premium` (lub `admin`). Dla `user` przycisk nie jest wyświetlany (lub jest wyświetlany jako zablokowany z czytelnym komunikatem „Funkcja Premium” – decyzja UX).
    3.  Kliknięcie przycisku uruchamia generowanie zdjęcia na podstawie **aktualnego stanu formularza** (w tym niezapisanych zmian: nazwa/opis/składniki/kategoria itp.).
    4.  W trakcie generowania użytkownik widzi czytelny stan ładowania, a ponowne kliknięcie akcji jest zablokowane.
    5.  Po sukcesie użytkownik widzi podgląd wygenerowanego zdjęcia oraz akcje: **„Zastosuj”** i **„Odrzuć”**.
    6.  Dopiero akcja „Zastosuj” powoduje zastąpienie aktualnego zdjęcia przepisu (bez automatycznego nadpisania w momencie wygenerowania).
    7.  Po zastosowaniu zdjęcia, użytkownik otrzymuje potwierdzenie (Toast/Snackbar) z akcją **„Cofnij”** (spójnie z istniejącą obsługą zdjęć), działającą do czasu zapisu przepisu.
    8.  Wygenerowane zdjęcie spełnia kontrakt stylu: **realistyczne (photorealistic), rustykalny drewniany stół, naturalne światło, brak ludzi/rąk, brak tekstu, brak watermarków**.
    9.  W razie błędu technicznego (np. błąd usługi AI) użytkownik widzi czytelny komunikat oraz może ponowić próbę.
    10. Technicznie (MVP): generowanie korzysta z modelu **`gpt-image-1.5`** i zwraca podgląd jako **`image/webp` 1024×1024** z ustawieniami `background=auto`, `quality=auto`, `n=1`.

---
-   *ID:* US-046
-   *Tytuł:* Generowanie zdjęcia AI z referencją (automatyczny tryb, premium)
-   *Opis:* Jako użytkownik `premium`, chcę aby generowanie zdjęcia AI automatycznie wykorzystywało dostępne zdjęcie przepisu jako referencję wyglądu potrawy, aby uzyskać nową, profesjonalną fotografię lepiej zgodną z tym, jak danie ma wyglądać, bez kopiowania istniejącego zdjęcia.
-   *Kryteria akceptacji:*
    1.  Jeśli w formularzu edycji przepisu jest dostępne zdjęcie (zapisane w przepisie lub wgrane/wklejone w trakcie edycji), kliknięcie przycisku AI uruchamia generowanie w trybie **„z referencją zdjęcia”**.
    2.  Jeśli w formularzu nie ma dostępnego zdjęcia, kliknięcie przycisku AI uruchamia generowanie w trybie **„bez zdjęcia”** (jak dotychczas, na podstawie treści przepisu).
    3.  UI sygnalizuje aktualnie wybrany tryb przed uruchomieniem generowania (np. tooltip przy przycisku AI: „Generuj z przepisu” / „Generuj z referencją zdjęcia”).
    4.  W trybie „z referencją zdjęcia” generowanie:
        - używa zdjęcia wyłącznie jako wskazówki wyglądu potrawy,
        - tworzy **całkowicie nowe** zdjęcie z inną kompozycją, kątem i aranżacją,
        - nie zawiera tekstu, logotypów ani ludzi (lub części ludzi).
    5.  Po sukcesie użytkownik widzi podgląd oraz akcje: **„Zastosuj”** i **„Odrzuć”** (bez automatycznego nadpisania zdjęcia).
    6.  Po „Zastosuj” zdjęcie jest ustawione w formularzu i traktowane jak standardowa zmiana zdjęcia (Snackbar/Toast z akcją **„Cofnij”** do czasu zapisu).
    7.  W razie błędu generowania użytkownik widzi czytelny komunikat i może ponowić próbę.

---
-   *ID:* US-006
-   *Tytuł:* Usuwanie przepisu
-   *Opis:* Jako użytkownik, chcę móc trwale usunąć przepis z mojej kolekcji, gdy nie jest mi już potrzebny.
-   *Kryteria akceptacji:*
    1.  Na stronie przepisu znajduje się przycisk "Usuń".
    2.  Kliknięcie przycisku "Usuń" wyświetla okno modalne z prośbą o potwierdzenie operacji.
    3.  Po potwierdzeniu, przepis jest trwale usuwany z bazy danych.
    4.  Po usunięciu przepisu, jestem przekierowywany na stronę z listą wszystkich moich przepisów.

---
-   *ID:* US-007
-   *Tytuł:* Przeglądanie listy wszystkich przepisów
-   *Opis:* Jako użytkownik, chcę widzieć listę moich przepisów oraz publicznych przepisów innych autorów zapisanych w co najmniej jednej mojej kolekcji, abym mógł szybko zorientować się w mojej bibliotece i wybrać interesującą mnie pozycję.
-   *Kryteria akceptacji:*
    1.  Dostępna jest chroniona strona "Moje przepisy" pod ścieżką `/my-recipies` (alias: `/my-recipes`).
    2.  Lista zawiera wszystkie przepisy, których autorem jest zalogowany użytkownik (niezależnie od widoczności).
    3.  Lista zawiera również przepisy innych autorów **wyłącznie** jeśli:
        - przepis ma widoczność `Publiczny`,
        - przepis jest dodany do co najmniej jednej kolekcji, której właścicielem jest zalogowany użytkownik.
    4.  Przepisy innych autorów (widoczne dzięki moim kolekcjom) są oznaczone na liście chipem/etykietą "W moich kolekcjach".
    5.  Każdy przepis na liście jest reprezentowany przez miniaturkę zdjęcia i nazwę.
    6.  Kliknięcie na pozycję na liście przenosi mnie do strony szczegółów danego przepisu.
    7.  Mam możliwość sortowania listy alfabetycznie oraz po dacie dodania (od najnowszych do najstarszych i odwrotnie).
    8.  Mam możliwość filtrowania listy także po flagach **"Termorobot"** (tak/nie) oraz **"Grill"** (tak/nie) obok istniejących filtrów (kategoria/tag).
    9.  Wejście na listę przepisów jest możliwe po zalogowaniu (np. poprzez link w Sidebarze). (Opcjonalnie) `/recipes` może przekierowywać do `/my-recipies` dla kompatybilności wstecznej.

---
-   *ID:* US-029
-   *Tytuł:* Oznaczenie przepisu jako "Termorobot" i jego widoczna identyfikacja
-   *Opis:* Jako użytkownik, chcę oznaczyć przepis flagą "Termorobot" oraz widzieć tę informację w szczegółach i na listach, abym szybko rozpoznawał przepisy przeznaczone do robotów typu Thermomix/Lidlomix.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępna jest flaga "Termorobot" w formie kontrolki typu checkbox/toggle.
    2.  Domyślnie flaga jest wyłączona dla nowych przepisów.
    3.  Po zapisaniu, wartość flagi jest trwałe zapisana i widoczna po ponownym otwarciu przepisu.
    4.  Na kartach/listach przepisów (np. "Moje przepisy", listy w kolekcjach) przepis oznaczony jako "Termorobot" posiada czytelny, nienachalny badge/chip "Termorobot".
    5.  W widoku szczegółów przepisu, jeśli flaga jest włączona, widoczny jest badge/chip "Termorobot" obok metadanych przepisu.
    6.  Użytkownik może wyłączyć flagę dla istniejącego przepisu i po zapisie oznaczenie znika z UI.

---
-   *ID:* US-043
-   *Tytuł:* Oznaczenie przepisu jako "Grill" i jego widoczna identyfikacja
-   *Opis:* Jako użytkownik, chcę oznaczyć przepis flagą "Grill" oraz widzieć tę informację na kartach/listach i w szczegółach, abym szybko rozpoznawał przepisy przeznaczone na grilla.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępna jest flaga **"Grill"** w formie kontrolki typu checkbox/toggle.
    2.  Domyślnie flaga jest wyłączona dla nowych przepisów.
    3.  Po zapisaniu, wartość flagi jest trwałe zapisana i widoczna po ponownym otwarciu przepisu.
    4.  Na kartach/listach przepisów (np. "Moje przepisy", listy w kolekcjach, katalog publiczny) przepis oznaczony jako "Grill" posiada czytelną ikonkę grilla z tooltipem **„Grill”**.
    5.  W widoku szczegółów przepisu, jeśli flaga jest włączona, widoczna jest metadana z ikonką grilla oraz etykietą **„Grill”** (np. chip/badge) obok innych metadanych przepisu.
    6.  Użytkownik może wyłączyć flagę dla istniejącego przepisu i po zapisie oznaczenie znika z UI.

---
-   *ID:* US-025
-   *Tytuł:* Oznaczenie cudzych przepisów zapisanych w moich kolekcjach
-   *Opis:* Jako użytkownik, chcę łatwo odróżnić na liście "Moje przepisy" przepisy mojego autorstwa od publicznych przepisów innych autorów zapisanych w moich kolekcjach, abym nie próbował wykonywać akcji, do których nie mam uprawnień.
-   *Kryteria akceptacji:*
    1.  Jeśli przepis na liście "Moje przepisy" nie należy do mnie, widzę na jego karcie chip/etykietę "W moich kolekcjach".
    2.  Po wejściu w szczegóły takiego przepisu nie widzę przycisków "Edytuj" i "Usuń".
    3.  Reguła obowiązuje niezależnie od miejsca wejścia w szczegóły przepisu (np. z listy "Moje przepisy", z kolekcji, z widoków publicznych).

---
-   *ID:* US-008
-   *Tytuł:* Obsługa pustej listy przepisów
-   *Opis:* Jako nowy użytkownik, który nie dodał jeszcze żadnego przepisu, chcę zobaczyć pomocny komunikat zamiast pustej strony, aby wiedzieć, co powinienem zrobić dalej.
-   *Kryteria akceptacji:*
    1.  Gdy użytkownik nie ma żadnych przepisów, na stronie "Moje przepisy" wyświetlany jest "stan pusty".
    2.  Komunikat zawiera tekst informujący o braku przepisów.
    3.  Komunikat zawiera wyraźnie widoczny przycisk lub link "Dodaj przepis", który przenosi do formularza tworzenia nowego przepisu.

---
-   *ID:* US-009
-   *Tytuł:* Wyszukiwanie przepisów
-   *Opis:* Jako użytkownik, chcę móc szybko znaleźć konkretny przepis, wpisując szukaną frazę w polu wyszukiwania, aby nie musieć ręcznie przeglądać całej listy.
-   *Kryteria akceptacji:*
    1.  Na stronie z listą przepisów znajduje się pole wyszukiwania.
    2.  Po wpisaniu frazy i zatwierdzeniu, lista przepisów jest filtrowana dynamicznie.
    3.  Wyszukiwanie obejmuje nazwę przepisu, listę składników, **wskazówki** oraz przypisane tagi.
    4.  Wyświetlane są tylko te przepisy, które pasują do kryteriów wyszukiwania.

---
-   *ID:* US-010
-   *Tytuł:* Organizowanie przepisu za pomocą kategorii i tagów
-   *Opis:* Jako użytkownik, chcę móc przypisać mój przepis do kategorii i dodać do niego własne tagi, aby łatwiej go później klasyfikować i odnajdywać.
-   *Kryteria akceptacji:*
    1.  W formularzu dodawania/edycji przepisu mogę wybrać jedną kategorię z predefiniowanej listy (np. dropdown).
    2.  W formularzu znajduje się pole do wprowadzania tagów.
    3.  Po wpisaniu tagu i jego zatwierdzeniu (np. klawiszem Enter), pojawia się on jako wizualna "pigułka".
    4.  Mogę usunąć dodany tag, klikając na niego.
    5.  Na stronie listy przepisów mogę filtrować widok po wybranej kategorii oraz po tagach.

---
-   *ID:* US-011
-   *Tytuł:* Tworzenie i zarządzanie kolekcjami przepisów
-   *Opis:* Jako użytkownik, chcę móc tworzyć własne, tematyczne zbiory przepisów (kolekcje), aby grupować receptury według okazji lub przeznaczenia, np. "Ulubione dania świąteczne".
-   *Kryteria akceptacji:*
    1.  Istnieje strona "Moje kolekcje", gdzie mogę zobaczyć listę moich kolekcji.
    2.  Na tej stronie mogę stworzyć nową kolekcję, podając jej nazwę.
    3.  Mogę edytować nazwę istniejącej kolekcji.
    4.  Mogę usunąć całą kolekcję (operacja nie usuwa przepisów, tylko zbiór).
    5.  Kliknięcie na nazwę kolekcji przenosi mnie do widoku przepisów należących do tej kolekcji.

---
-   *ID:* US-055
-   *Tytuł:* Nawigacja po kolekcjach w Sidebarze (drzewo: kolekcje → przepisy)
-   *Opis:* Jako zalogowany użytkownik, chcę móc rozwinąć w Sidebarze „Kolekcje” i od razu wybrać przepis z konkretnej kolekcji, aby szybciej otwierać przepisy bez przechodzenia przez widoki list.
-   *Kryteria akceptacji:*
    1.  W Sidebarze pozycja „Kolekcje” posiada chevron do zwijania/rozwijania listy kolekcji.
    2.  Kliknięcie w etykietę „Kolekcje” przenosi do `/collections`, a kliknięcie w chevron tylko rozwija/zwija (bez nawigacji).
    3.  Po rozwinięciu „Kolekcje” widzę listę moich kolekcji (poziom 2).
    4.  Każda kolekcja ma własny chevron do rozwijania listy przepisów (poziom 3).
    5.  Lista przepisów danej kolekcji jest ładowana leniwie dopiero po rozwinięciu tej kolekcji.
    6.  Każdy przepis w liście pokazuje nazwę oraz małą miniaturę z ilustracji przepisu (jeśli przepis ma zdjęcie).
    7.  Kliknięcie w przepis w Sidebarze przenosi do widoku szczegółów przepisu pod `/recipes/:id-:slug`.
    8.  Dla stanów pustych/błędów (brak kolekcji, brak przepisów w kolekcji, brak dostępu) UI prezentuje czytelne, nienachalne komunikaty w obrębie Sidebara (bez blokowania całej aplikacji).

---
-   *ID:* US-012
-   *Tytuł:* Dodawanie i usuwanie przepisów z kolekcji
-   *Opis:* Jako użytkownik, chcę móc łatwo dodawać przepisy do moich kolekcji oraz je z nich usuwać, aby elastycznie zarządzać moimi zbiorami.
-   *Kryteria akceptacji:*
    1.  Na stronie szczegółów przepisu znajduje się opcja (np. przycisk "Dodaj do kolekcji"), która otwiera okno modalne zarządzania przynależnością przepisu do kolekcji.
    2.  W modalu użytkownik widzi listę swoich kolekcji z kontrolkami typu **checkbox**, umożliwiającą przypisanie przepisu do **wielu** kolekcji jednocześnie (zaznacz/odznacz).
    3.  Modal domyślnie pokazuje stan aktualny: kolekcje, w których przepis już jest, są **zaznaczone**.
    4.  Użytkownik może zapisać stan, w którym przepis nie należy do żadnej kolekcji (**0 zaznaczonych**).
    5.  Użytkownik może w modalu utworzyć nową kolekcję (podając nazwę), a nowo utworzona kolekcja pojawia się na liście i jest automatycznie zaznaczona.
    6.  Zapis w modalu jest wykonywany jako jedna operacja i ustawia **docelową** listę kolekcji dla przepisu (bez konieczności wykonywania wielu akcji po jednej kolekcji).
    7.  Po pomyślnym zapisie użytkownik widzi czytelne potwierdzenie (np. Snackbar/Toast), a modal się zamyka.
    8.  W przypadku błędu (np. brak uprawnień / błąd sieci) użytkownik widzi czytelny komunikat, a jego wybory w modalu nie są tracone.
    9.  W widoku kolekcji, przy każdym przepisie, znajduje się opcja pozwalająca na usunięcie go z tej konkretnej kolekcji.
    10. Usunięcie przepisu z kolekcji nie usuwa samego przepisu z ogólnej bazy przepisów użytkownika.

---

-   *ID:* US-044
-   *Tytuł:* Masowe zarządzanie przypisaniem przepisu do kolekcji (checkboxy)
-   *Opis:* Jako użytkownik, chcę w jednym oknie zaznaczyć i odznaczyć wiele kolekcji dla przepisu, aby szybko uporządkować moje przepisy bez wykonywania wielu oddzielnych operacji.
-   *Kryteria akceptacji:*
    1.  Po kliknięciu akcji „Dodaj do kolekcji” otwiera się modal z tytułem (np. „Kolekcje”) oraz listą kolekcji w formie **checkboxów**.
    2.  Modal ma pole „Szukaj kolekcji”, które filtruje listę **po stronie frontendu** po nazwie (bez dodatkowych endpointów/parametrów API).
    3.  Modal jest odpowiednio duży na desktopie (większy niż standardowe małe okna), a lista kolekcji jest przewijana wewnątrz modala.
    4.  Kolekcje, w których przepis już jest, są w momencie otwarcia modala zaznaczone.
    5.  Użytkownik może:
        - zaznaczyć kilka kolekcji naraz,
        - odznaczyć kolekcje (usunąć przepis z kolekcji),
        - pozostawić 0 zaznaczonych (przepis nie należy do żadnej kolekcji).
    6.  Modal umożliwia utworzenie nowej kolekcji bez opuszczania okna. Po utworzeniu:
        - nowa kolekcja pojawia się na liście,
        - jest automatycznie zaznaczona,
        - użytkownik może nadal zmieniać inne checkboxy przed zapisem.
    7.  Akcja „Zapisz” wykonuje pojedynczą, atomową operację ustawiającą **docelową** listę `collection_ids` dla przepisu (idempotentnie).
    8.  W trakcie zapisu UI pokazuje stan ładowania i blokuje wielokrotne wysłanie.
    9.  Po sukcesie modal się zamyka, a użytkownik widzi potwierdzenie zawierające informację, że przypisanie zostało zaktualizowane (np. „Zapisano kolekcje dla przepisu”).
    10. W przypadku błędów walidacji/uprawnień UI pokazuje czytelny komunikat (np. „Nie masz dostępu do jednej z kolekcji”) i nie traci stanu zaznaczeń.

---
-   *ID:* US-038
-   *Tytuł:* Dodanie przepisu do „Mojego planu” z widoku szczegółów
-   *Opis:* Jako zalogowany użytkownik mający dostęp do przepisu (własnego lub publicznego), chcę dodać go do mojej listy „Mój plan” bez opuszczania widoku szczegółów, aby szybko budować listę przepisów do wykorzystania.
-   *Kryteria akceptacji:*
    1.  Na widoku szczegółów przepisu, gdy jestem zalogowany, w nagłówku strony (Page Header) obok akcji „Dodaj do kolekcji” widzę przycisk „Dodaj do planu” z ikoną listy z plusikiem.
    2.  Po kliknięciu „Dodaj do planu” przycisk przechodzi w stan ładowania: etykieta/przycisk zamienia się w spinner, a ponowne kliknięcie jest zablokowane.
    3.  Po pomyślnym dodaniu przepisu do planu:
        - przycisk pokazuje ikonę „ptaszka” (stan sukcesu),
        - etykieta zmienia się na „Zobacz listę”.
    4.  Jeśli wejdę na przepis, który już jest w moim planie, to przycisk od razu ma stan „Zobacz listę” (bez możliwości ponownego dodania).
    5.  Kliknięcie „Zobacz listę” otwiera wysuwany panel (drawer) z listą „Mój plan” z prawej strony ekranu.
    6.  Jeśli plan osiągnął limit **50** przepisów, próba dodania kolejnego kończy się czytelnym komunikatem błędu i przepis nie jest dodawany.
    7.  System nie tworzy duplikatów: ten sam przepis może wystąpić w „Moim planie” maksymalnie raz.

---
-   *ID:* US-039
-   *Tytuł:* Przeglądanie i zarządzanie listą „Mój plan”
-   *Opis:* Jako zalogowany użytkownik, chcę otworzyć listę „Mój plan”, usunąć z niej pojedynczy przepis albo wyczyścić całą listę, abym mógł utrzymywać plan w porządku.
-   *Kryteria akceptacji:*
    1.  Drawer „Mój plan” zawiera listę przepisów w kolejności **od najnowszych** (ostatnio dodane na górze).
    2.  Każdy element listy zawiera: miniaturę/obrazek przepisu, nazwę oraz ikonę kosza do usunięcia tego przepisu z planu.
    3.  Kliknięcie w element listy (poza ikoną kosza) przenosi do widoku szczegółów danego przepisu.
    4.  W nagłówku drawer’a widoczne są akcje: ikona kosza do wyczyszczenia całej listy oraz ikona „X” do zamknięcia panelu.
    5.  Po otwarciu drawer’a pozostały content strony jest lekko przyciemniony, a kliknięcie w przyciemniony obszar zamyka drawer.
    6.  Gdy „Mój plan” zawiera co najmniej jeden przepis, na dole ekranu po prawej stronie widoczny jest pływający przycisk „Mój plan”, który otwiera drawer.

---
-   *ID:* US-031
-   *Tytuł:* Wyświetlanie wszystkich przepisów kolekcji bez paginacji
-   *Opis:* Jako użytkownik, chcę po wejściu w kolekcję zobaczyć od razu pełną listę jej przepisów, abym mógł szybko przeglądać zawartość bez doładowywania kolejnych porcji.
-   *Kryteria akceptacji:*
    1.  Wejście na ścieżkę `/collections/:id` wyświetla nazwę kolekcji oraz listę przypisanych do niej przepisów.
    2.  Lista przepisów kolekcji ładuje się **jednorazowo** i jest renderowana w całości (w ramach limitu technicznego API, jeśli istnieje).
    3.  W UI nie występuje paginator ani przycisk "Więcej" dla listy przepisów kolekcji.
    4.  W trakcie ładowania użytkownik widzi czytelny stan ładowania (np. skeleton listy/siatki).
    5.  Gdy kolekcja nie zawiera żadnych przepisów, widoczny jest stan pusty z jasnym komunikatem i akcją powrotu (np. do `/collections`).
    6.  Dla błędów dostępu (np. `404`/`403`) widoczny jest czytelny komunikat oraz akcja powrotu do listy kolekcji.
    7.  Jeśli API sygnalizuje przekroczenie limitu technicznego, użytkownik widzi komunikat o niepełnym wyniku oraz instrukcję dalszego kroku (np. spróbuj ponownie później / zawęź listę w przyszłej wersji).

---
-   *ID:* US-013
-   *Tytuł:* Importowanie nowego przepisu z tekstu
-   *Opis:* Jako użytkownik, chcę móc szybko dodać nowy przepis, wklejając jego pełną treść w ustandaryzowanym formacie tekstowym, aby zminimalizować czas potrzebny na ręczne wprowadzanie danych.
-   *Kryteria akceptacji:*
    1.  Dostępny jest nowy widok "Importuj przepis" z jednym polem `textarea`.
    2.  Użytkownik może wkleić tekst przepisu, który zawiera nazwę, listę składników i listę kroków.
    3.  System poprawnie parsuje tekst, identyfikując:
        -   Nazwę przepisu (linia zaczynająca się od `#`).
        -   Główne sekcje "Składniki" i "Kroki" (linie zaczynające się od `##`).
        -   Podsekcje/nagłówki wewnątrz składników i kroków (linie zaczynające się od `###`).
        -   Poszczególne składniki i kroki (linie zaczynające się od `-` lub numeracji typu `1.`). System usuwa te znaczniki podczas importu, pozostawiając samą treść.
    4.  Po kliknięciu przycisku "Importuj", tworzony jest nowy przepis w bazie danych.
    5.  Po pomyślnym zaimportowaniu, jestem przekierowywany bezpośrednio do formularza edycji nowo utworzonego przepisu, aby uzupełnić brakujące dane (np. kategoria, tagi, zdjęcie).
    6.  W przypadku błędu parsowania, wyświetlany jest czytelny komunikat o błędzie.

---

-   *ID:* US-036
-   *Tytuł:* Asystowane dodawanie przepisu z tekstu lub obrazu (AI)
-   *Opis:* Jako użytkownik, chcę wkleić dowolny tekst lub obraz przepisu i otrzymać wstępnie wypełniony formularz, abym szybciej dodał przepis bez ręcznego przepisywania.
-   *Kryteria akceptacji:*
    1.  Po kliknięciu akcji „Dodaj przepis” widzę ekran wyboru trybu:
        - „Pusty formularz”
        - „Z tekstu/zdjęcia (AI)”.
    2.  Po wybraniu „Pusty formularz” system otwiera standardowy formularz tworzenia przepisu bez wstępnie wypełnionych danych.
    3.  Po wybraniu „Z tekstu/zdjęcia (AI)” system wyświetla ekran z:
        - polem `textarea` na wklejenie tekstu,
        - strefą wklejenia obrazu ze schowka (Ctrl+V) jako alternatywą dla tekstu,
        - przyciskiem „Dalej”.
    4.  Ekran wspiera tryb **albo tekst, albo obraz** (użytkownik wybiera źródło); system nie przetwarza obu jednocześnie.
    5.  Jeśli użytkownik nie wprowadzi żadnych danych (puste `textarea` i brak obrazu), kliknięcie „Dalej” otwiera standardowy pusty formularz tworzenia przepisu.
    6.  Jeśli użytkownik wprowadzi dane, system wywołuje usługę AI i otrzymuje odpowiedź w **ściśle zdefiniowanym formacie JSON**, możliwą do deterministycznego sparsowania.
    7.  Na podstawie odpowiedzi AI system wstępnie wypełnia formularz danymi: tytuł, opis, składniki, kroki, kategoria, tagi.
        - kategoria i tagi są **wnioskowane** na podstawie treści przepisu.
    8.  Użytkownik może edytować wszystkie wstępnie uzupełnione pola przed zapisem.
    9.  Jeśli dane wejściowe **nie opisują pojedynczego przepisu**, system pokazuje czytelny komunikat błędu (z krótką wskazówką co poprawić) i pozostaje na ekranie wklejania (bez przejścia do formularza).
    10. W czasie przetwarzania AI użytkownik widzi stan ładowania, a przycisk „Dalej” jest zablokowany.
    11. W przypadku błędu technicznego (np. sieć, limit, błąd usługi) system pokazuje czytelny komunikat i pozostaje na ekranie wklejania, umożliwiając ponowienie.

---
-   *ID:* US-014
-   *Tytuł:* Globalna nawigacja i orientacja (App Shell)
-   *Opis:* Jako użytkownik, chcę mieć stały dostęp do menu głównego i wiedzieć dokładnie, w którym miejscu struktury aplikacji się znajduję, abym mógł poruszać się po niej szybko i bez zgadywania.
-   *Kryteria akceptacji:*
    1.  Aplikacja posiada stały pasek boczny (Sidebar) zawierający linki wyłącznie do głównych modułów prywatnych: Moja Pycha, Przepisy, Kolekcje, Ustawienia.
    2.  Pasek boczny nie zawiera przycisków operacyjnych (takich jak "Dodaj przepis").
    3.  Topbar zawiera stałą główną nawigację (zakładki) z pozycjami: `Moja Pycha` (`/dashboard`) oraz `Odkrywaj przepisy` (`/explore`).
    4.  Aktualna pozycja nawigacji jest zawsze wyróżniona w Topbarze (orientacja "gdzie jestem").
    5.  Breadcrumbs są wyświetlane jako element orientacyjny na głębszych trasach (np. `Kolekcje > Święta > Sernik`) i pozwalają wrócić do widoku nadrzędnego.
    6.  Topbar udostępnia globalne wyszukiwanie (Omnibox) jako stałą ikonę/akcję w przewidywalnym miejscu (może otwierać overlay), dostępne z każdego ekranu w trybie zalogowanego.
    7.  Sidebar jest widoczny wyłącznie na ścieżkach: `/dashboard`, `/my-recipies` (alias: `/my-recipes`), `/recipes/**`, `/collections/**`, `/settings/**`.
    8.  Na urządzeniach mobilnych główna nawigacja jest dostępna w formie menu rozwijanego (hamburger / drawer) i zachowuje tę samą kolejność oraz etykiety.

---
-   *ID:* US-015
-   *Tytuł:* Spójny pasek akcji (Page Header)
-   *Opis:* Jako użytkownik, chcę, aby przyciski kluczowych akcji (Dodaj, Zapisz, Edytuj) znajdowały się zawsze w tym samym, przewidywalnym miejscu na górze strony, abym nie musiał ich szukać przewijając treść.
-   *Kryteria akceptacji:*
    1.  Każdy widok (lista, szczegóły, formularz) posiada nagłówek (Page Header) umieszczony pod Topbarem a nad treścią właściwą.
    2.  Nagłówek zawiera tytuł aktualnego widoku po lewej stronie.
    3.  Prawa strona nagłówka to "Toolbar Akcji" zawierający wszystkie dostępne operacje dla danego kontekstu.
    4.  W widokach edycji/tworzenia, przycisk "Zapisz" jest umieszczony w nagłówku i pozostaje widoczny (sticky) nawet podczas przewijania długiego formularza.

---
-   *ID:* US-016
-   *Tytuł:* Zarządzanie widocznością przepisu
-   *Opis:* Jako autor przepisu, chcę móc określić, kto może zobaczyć mój przepis, aby zachować prywatność moich notatek lub podzielić się nimi ze światem.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępna jest sekcja "Widoczność".
    2.  Dostępne są trzy opcje wyboru: "Prywatny", "Współdzielony", "Publiczny".
    3.  Domyślnie zaznaczona jest opcja "Prywatny".
    4.  Użytkownik może zmienić widoczność w dowolnym momencie edycji przepisu.
    5.  Wybrana opcja jest zapisywana wraz z przepisem w bazie danych.

---
-   *ID:* US-032
-   *Tytuł:* Podgląd widoczności mojego przepisu na liście (ikonka na karcie)
-   *Opis:* Jako zalogowany użytkownik, gdy widzę na liście mój przepis, chcę od razu rozpoznać jego widoczność po ikonce na karcie, abym nie musiał wchodzić w edycję lub szczegóły przepisu.
-   *Kryteria akceptacji:*
    1.  Na kartach przepisów w listach (np. `/my-recipies`, `/explore`) dla przepisu mojego autorstwa widoczna jest ikonka reprezentująca aktualną wartość `visibility`.
    2.  Ikonka ma trzy stany odpowiadające wartościom `visibility`: `Prywatny`, `Współdzielony`, `Publiczny`.
    3.  Po najechaniu na ikonkę (lub tapnięciu na mobile) wyświetla się tooltip z tekstem: `Prywatny` / `Współdzielony` / `Publiczny`.
    4.  Ikonka ma charakter wyłącznie informacyjny (w MVP nie zmienia widoczności z poziomu listy).
    5.  Dla przepisów nie mojego autorstwa ikonka widoczności nie jest wyświetlana.

---
-   *ID:* US-017
-   *Tytuł:* Landing dla gościa z publicznymi przepisami
-   *Opis:* Jako użytkownik niezalogowany, chcę wejść na stronę główną i od razu zobaczyć ciekawe publiczne przepisy oraz pole wyszukiwania, abym mógł szybko znaleźć inspirację i zrozumieć wartość aplikacji.
-   *Kryteria akceptacji:*
    1.  Wejście na adres `/` dla gościa wyświetla landing zawierający pole wyszukiwania oraz sekcje z publicznymi przepisami (np. Najnowsze, Popularne, Sezonowe).
    2.  Każda karta przepisu zawiera co najmniej: zdjęcie (jeśli istnieje), nazwę oraz kategorię (jeśli przypisana).
    3.  Kliknięcie w kartę publicznego przepisu przenosi do widoku szczegółów publicznego przepisu.
    4.  Landing zawiera widoczne akcje "Zaloguj się" i "Zarejestruj się".
    5.  Landing nie wyświetla przepisów o widoczności `Prywatny` ani `Współdzielony`.

---
-   *ID:* US-018
-   *Tytuł:* Wyszukiwanie publicznych przepisów (MVP: tylko tekst)
-   *Opis:* Jako użytkownik niezalogowany, chcę wyszukać publiczne przepisy po frazie tekstowej, abym mógł szybko znaleźć interesujące mnie propozycje.
-   *Kryteria akceptacji:*
    1.  Gość ma dostęp do pola wyszukiwania publicznych przepisów.
    2.  Wyszukiwanie uruchamia się od **3 znaków** (po trim). Dla krótszej frazy nie wykonywane jest wyszukiwanie.
    3.  Wyszukiwanie jest tekstowe i przeszukuje co najmniej: nazwę przepisu, składniki oraz tagi.
        - tagi dopasowują się jako **pełna nazwa** lub **prefix**.
        - fraza wielowyrazowa działa jako **AND**.
    4.  Wyniki zawierają wyłącznie przepisy o widoczności `Publiczny`.
    5.  Domyślna kolejność wyników to **najlepsze dopasowanie** (priorytet: nazwa → składniki → tagi; punktacja ważona 3/2/1).
    6.  Dla pustej frazy (po trim) katalog zachowuje się jak feed (np. sortowanie `created_at.desc`), a nie jak wyszukiwanie.
    7.  Wyniki są ładowane porcjami: domyślnie wyświetla się 12 pozycji, a kolejne są doładowywane przyciskiem "Więcej" (dopisywane pod już widocznymi), o ile są dostępne.
    8.  Dla braku wyników wyświetlany jest czytelny komunikat i sugestia zmiany frazy.
    9.  Każdy wynik na liście posiada krótką informację „Dopasowanie: nazwa / składniki / tagi” (w zależności od tego, gdzie wykryto dopasowanie), aby zwiększyć zaufanie do rankingu.

---
-   *ID:* US-044
-   *Tytuł:* Ranking wyników wyszukiwania publicznych przepisów (relevance)
-   *Opis:* Jako użytkownik (gość lub zalogowany na widokach publicznych), chcę otrzymywać wyniki wyszukiwania w kolejności najlepszego dopasowania, abym szybciej znajdował to, czego szukam bez ręcznego sortowania.
-   *Kryteria akceptacji:*
    1.  Jeśli fraza wyszukiwania ma co najmniej **3 znaki** (po trim), API oraz UI traktują zapytanie jako wyszukiwanie i sortują wyniki domyślnie po **relevance**.
    2.  Relevance jest wyliczana jako punktacja ważona: dopasowanie w **nazwie** ma wagę **3**, w **składnikach** wagę **2**, a w **tagach** wagę **1**.
    3.  Dla zapytań wielowyrazowych (np. `kurczak ryz`) obowiązuje semantyka **AND**.
    4.  Dla remisów relevance stosowane jest stabilne rozstrzygnięcie (np. `created_at.desc`).
    5.  UI pokazuje przy każdym wyniku czytelną etykietę: „Dopasowanie: …” zgodną z tym, które pola faktycznie miały dopasowanie.

---
-   *ID:* US-030
-   *Tytuł:* Przycisk „Więcej” do doładowywania list przepisów (zamiast paginatora)
-   *Opis:* Jako użytkownik (gość lub zalogowany), chcę doładowywać kolejne przepisy przyciskiem „Więcej” bez klasycznej paginacji, aby przeglądać dłuższe listy płynnie i bez „skoków” między stronami.
-   *Zakres:* Dotyczy list opartych o komponent `pych-recipe-list` w widokach `/my-recipies` oraz `/explore`.
-   *Kryteria akceptacji:*
    1.  Na wejściu do listy ładowane jest domyślnie **12** przepisów (pierwsza porcja).
    2.  Pod listą (pod siatką kart) widoczny jest przycisk **„Więcej”** tylko wtedy, gdy istnieją kolejne wyniki do załadowania.
    3.  Kliknięcie „Więcej” doładowuje kolejne **12** przepisów i **dopina** je pod już wyświetlonymi (lista rośnie).
    4.  W trakcie doładowania przycisk „Więcej” jest `disabled` i pokazuje stan ładowania (np. etykieta „Ładowanie…”).
    5.  Gdy nie ma więcej wyników, przycisk „Więcej” znika.
    6.  Zmiana kontekstu listy (wyszukiwanie / filtry / sortowanie) resetuje listę do pierwszych 12 wyników oraz ponownie wyznacza widoczność przycisku „Więcej”.
    7.  W przypadku błędu doładowania system pokazuje czytelny komunikat (Toast/Snackbar), a użytkownik może ponowić próbę (np. ponownie klikając „Więcej”).

---
-   *ID:* US-019
-   *Tytuł:* Przeglądanie szczegółów publicznego przepisu
-   *Opis:* Jako użytkownik niezalogowany, chcę wyświetlić pełne szczegóły publicznego przepisu w czytelnym układzie, abym mógł z niego korzystać bez konieczności zakładania konta.
-   *Kryteria akceptacji:*
    1.  Strona szczegółów publicznego przepisu wyświetla: nazwę, opis, zdjęcie, listę składników i listę kroków.
    2.  Na widoku desktopowym składniki i kroki są wyświetlane obok siebie w dwóch kolumnach.
    3.  Lista kroków jest numerowana w sposób ciągły i nie resetuje się po nagłówkach sekcji.
    4.  Widoczne są kategoria oraz tagi (jeśli istnieją).
    5.  Widok jest dostępny publicznie pod kanoniczną ścieżką `/explore/recipes/:id-:slug` (bez ochrony routingu) i nie wyświetla Sidebara.
    6.  Dla przepisu o widoczności `Prywatny` / `Współdzielony` widok publiczny:
        - zwraca `404` dla gościa,
        - zwraca `404` dla zalogowanego nie-autora,
        - zwraca `200` dla zalogowanego autora.
    7.  Dla zalogowanego autora, na widoku publicznym dostępne są akcje właściciela (np. "Edytuj", "Usuń") i prowadzą do chronionych ścieżek edycji/usuwania.
    8.  Strona jest dostępna pod publicznym, udostępnialnym adresem URL (SEO-friendly) w postaci `/explore/recipes/:id-:slug`, gdzie slug jest generowany z nazwy przepisu i nie zawiera polskich znaków diakrytycznych.
    9.  Wejście na `/explore/recipes/:id` lub na `/explore/recipes/:id-:slug` z niepoprawnym slugiem skutkuje automatyczną normalizacją (redirect/replaceUrl) do kanonicznego URL z poprawnym slugiem.
    10. Jeśli przepis ma uzupełnioną liczbę porcji, jest ona wyświetlana bezpośrednio pod tytułem przepisu (np. `4 porcje`, `6 porcji`).
    11. Jeśli przepis ma uzupełniony czas przygotowania, jest on wyświetlany **pod opisem** jako metadana z ikonką (np. `schedule`) oraz wartością w minutach (formatowaną w UI).
    12. Jeśli przepis ma uzupełniony czas całkowity, jest on wyświetlany **pod opisem** jako metadana z ikonką (np. `timer`) oraz wartością w minutach (formatowaną w UI).
    13. Jeśli dana wartość czasu nie jest ustawiona, odpowiadająca jej metadana nie jest wyświetlana.

---
-   *ID:* US-041
-   *Tytuł:* Kanoniczny link do przepisu z identyfikatorem i slugiem (publiczny i prywatny)
-   *Opis:* Jako użytkownik (gość lub zalogowany), chcę udostępniać link do przepisu w postaci zawierającej czytelną nazwę (slug), aby adres był przyjazny i jednoznaczny, a aplikacja zawsze prowadziła do kanonicznego URL.
-   *Kryteria akceptacji:*
    1.  Dla przepisu o `id = X` i nazwie `N`, aplikacja wyznacza slug `S` zgodnie z regułami z sekcji **3.7**.
    2.  Kanoniczny URL dla części publicznej ma postać `/explore/recipes/X-S`.
    3.  Kanoniczny URL dla części prywatnej ma postać `/recipes/X-S`.
    4.  Wejście na `/explore/recipes/X` normalizuje adres do `/explore/recipes/X-S` (redirect/replaceUrl).
    5.  Wejście na `/recipes/X` normalizuje adres do `/recipes/X-S` (redirect/replaceUrl).
    6.  Wejście na `/explore/recipes/X-zly-slug` lub `/recipes/X-zly-slug` normalizuje adres do bieżącego kanonicznego URL z poprawnym slugiem.
    7.  Slug jest lowercase, nie zawiera polskich znaków diakrytycznych, a separatory są w postaci `-`.
    8.  Jeśli po normalizacji slug jest pusty, aplikacja używa bezpiecznego fallback (np. `przepis`) tak, aby link zawsze miał postać `X-<niepusty-slug>`.

---

-   *ID:* US-042
-   *Tytuł:* Klasyfikacja przepisu (typ diety, kuchnia, trudność)
-   *Opis:* Jako autor przepisu, chcę móc opcjonalnie przypisać do przepisu typ diety, kuchnię oraz stopień trudności, aby szybciej organizować przepisy i od razu widzieć ich kontekst w szczegółach.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępne są pola (opcjonalne): **Typ diety**, **Kuchnia**, **Stopień trudności**.
    2.  **Typ diety** jest wybierany z listy kontrolowanej: `Mięso` / `Wege` / `Vegan` (wartość może być pusta).
    3.  **Kuchnia** jest wybierana z listy kontrolowanej: `Polska` / `Azjatycka` / `Meksykańska` / `Bliskowschodnia` (wartość może być pusta).
    4.  **Stopień trudności** jest wybierany z listy kontrolowanej: `Łatwe` / `Średnie` / `Trudne` (wartość może być pusta).
    5.  Po zapisaniu, wartości są trwałe zapisane i po ponownym wejściu w edycję formularz prezentuje aktualnie zapisane wartości.
    6.  W widoku szczegółów przepisu, ustawione wartości są widoczne jako metadane (np. chipy/badge) w przewidywalnym miejscu obok innych metadanych przepisu.
    7.  Jeśli pole nie jest ustawione, nie jest wyświetlane w szczegółach (brak „pustych” placeholderów).
-   *ID:* US-028
-   *Tytuł:* Ustawienie i wyświetlanie liczby porcji w przepisie
-   *Opis:* Jako autor przepisu, chcę opcjonalnie ustawić liczbę porcji podczas edycji przepisu, aby w widoku szczegółów pod tytułem widzieć informację, dla ilu porcji jest przepis.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępne jest pole "Liczba porcji" (opcjonalne).
    2.  Pole akceptuje wyłącznie liczbę całkowitą z zakresu `1-99`. Wartość spoza zakresu blokuje zapis i pokazuje błąd walidacji.
    3.  Użytkownik może pozostawić pole puste (brak wartości) i zapisać przepis bez liczby porcji.
    4.  W widoku szczegółów przepisu, jeśli liczba porcji jest ustawiona, wyświetla się bezpośrednio pod tytułem w formacie z poprawną odmianą (np. `1 porcja`, `2 porcje`, `5 porcji`).
    5.  Wartość jest zapisywana i po ponownym wejściu w edycję formularz prezentuje aktualnie zapisaną liczbę porcji.
    6.  Użytkownik może wyczyścić pole (ustawić brak wartości) i po zapisie liczba porcji przestaje być wyświetlana w szczegółach przepisu.

---
-   *ID:* US-040
-   *Tytuł:* Ustawienie i wyświetlanie czasów przygotowania oraz czasu całkowitego
-   *Opis:* Jako autor przepisu, chcę opcjonalnie ustawić czas przygotowania oraz czas całkowity w minutach, aby w szczegółach przepisu szybko ocenić ile czasu zajmie wykonanie dania.
-   *Kryteria akceptacji:*
    1.  W formularzu tworzenia i edycji przepisu dostępne są dwa pola (opcjonalne): „Czas przygotowania (min)” oraz „Czas całkowity (min)”.
    2.  Każde z pól akceptuje wyłącznie liczbę całkowitą w zakresie `0-999`. Wartość spoza zakresu blokuje zapis i pokazuje błąd walidacji.
    3.  Użytkownik może pozostawić pola puste (brak wartości) i zapisać przepis bez czasów.
    4.  Użytkownik może wpisać `0` jako poprawną wartość (np. dla przepisów „instant”).
    5.  Jeśli oba czasy są ustawione, system wymaga aby `czas całkowity >= czas przygotowania`. W przeciwnym razie zapis jest blokowany i pokazany jest błąd walidacji.
    6.  Po zapisaniu wartości są trwałe zapisane i po ponownym wejściu w edycję formularz prezentuje aktualnie zapisane czasy.
    7.  W widoku szczegółów przepisu, jeśli czas przygotowania jest ustawiony, wyświetla się **pod opisem** jako metadana z ikonką (np. `schedule`) oraz wartością sformatowaną (np. `45 min`, `1 h 20 min`).
    8.  W widoku szczegółów przepisu, jeśli czas całkowity jest ustawiony, wyświetla się **pod opisem** jako metadana z ikonką (np. `timer`) oraz wartością sformatowaną.
    9.  Jeśli dana wartość czasu nie jest ustawiona, odpowiadająca jej metadana nie jest wyświetlana.

---
-   *ID:* US-020
-   *Tytuł:* Publiczne widoki w trybie zalogowanego (App Shell)
-   *Opis:* Jako użytkownik zalogowany, chcę przeglądać publiczne widoki (landing, explore, publiczne szczegóły) bez przycisków logowania/rejestracji i z dostępem do nawigacji zalogowanej, abym mógł płynnie przechodzić między częścią publiczną a moim kontem.
-   *Kryteria akceptacji:*
    1.  Na ścieżkach `/`, `/explore`, `/explore/recipes/:id-:slug` zalogowany użytkownik nie widzi przycisków "Zaloguj się" ani "Zarejestruj się".
    2.  Zalogowany użytkownik widzi ikonę profilu (menu z co najmniej: "Profil/Ustawienia" oraz "Wyloguj").
    3.  Zalogowany użytkownik ma w nawigacji możliwość przejścia do `/dashboard`.
    4.  Zawartość merytoryczna na widokach publicznych pozostaje ograniczona do przepisów `Publiczny`.

---
-   *ID:* US-021
-   *Tytuł:* Dodanie publicznego przepisu do kolekcji z widoku publicznego
-   *Opis:* Jako użytkownik zalogowany, chcę móc dodać publiczny przepis do jednej z moich kolekcji bez opuszczania widoku publicznego, abym mógł zapisywać inspiracje.
-   *Kryteria akceptacji:*
    1.  Na publicznym widoku szczegółów przepisu, gdy przepis nie należy do mnie, widoczna jest akcja "Dodaj do kolekcji".
    2.  Po kliknięciu akcji otwiera się modal wyboru kolekcji (z listą moich kolekcji).
    3.  Po wybraniu kolekcji i potwierdzeniu, przepis zostaje dodany do kolekcji i użytkownik otrzymuje potwierdzenie (Toast/Snackbar).
    4.  Jeśli przepis jest już w kolekcji, system informuje o tym (czytelny komunikat) i nie tworzy duplikatu.
    5.  Akcja nie jest dostępna dla gościa (gość widzi CTA do logowania/rejestracji).

---
-   *ID:* US-022
-   *Tytuł:* Oznaczenie moich publicznych przepisów w katalogu publicznym
-   *Opis:* Jako użytkownik zalogowany, chcę widzieć, które przepisy w publicznym katalogu są moje, abym mógł je szybko rozpoznać.
-   *Kryteria akceptacji:*
    1.  W widokach `/` i `/explore` przepisy, których autorem jest zalogowany użytkownik, są oznaczone jako "Twój przepis" (badge/etykieta).
    2.  Oznaczenie jest czytelne, ale nie dominuje nad treścią karty przepisu.
    3.  Dla gościa oznaczenie nie jest wyświetlane.

---
-   *ID:* US-023
-   *Tytuł:* Wejście do "Moja Pycha" z Topbara
-   *Opis:* Jako użytkownik (gość lub zalogowany), chcę mieć możliwość przejścia do widoku "Moja Pycha" bezpośrednio z górnego paska (Topbar), aby szybko wracać do mojego punktu startowego.
-   *Kryteria akceptacji:*
    1.  W Topbarze widoczna jest stała główna nawigacja z pozycją "Moja Pycha".
    2.  Kliknięcie "Moja Pycha" przenosi użytkownika na ścieżkę `/dashboard`.
    3.  Dla gościa wejście na `/dashboard` wymaga logowania (redirect do logowania z możliwością powrotu po sukcesie).
    4.  Etykieta "Moja Pycha" zastępuje w UI wcześniejszą nazwę "Dashboard" (route i identyfikatory techniczne mogą pozostać bez zmian).

---
-   *ID:* US-026
-   *Tytuł:* Wejście do "Odkrywaj przepisy" z Topbara
-   *Opis:* Jako użytkownik (gość lub zalogowany), chcę mieć możliwość przejścia do widoku "Odkrywaj przepisy" bezpośrednio z górnego paska (Topbar), aby szybko znaleźć inspiracje w publicznych przepisach.
-   *Kryteria akceptacji:*
    1.  W Topbarze widoczna jest stała główna nawigacja z pozycją "Odkrywaj przepisy".
    2.  Kliknięcie "Odkrywaj przepisy" przenosi użytkownika na ścieżkę `/explore`.
    3.  Pozycja "Odkrywaj przepisy" jest widoczna zarówno dla gościa jak i dla użytkownika zalogowanego.
    4.  Na ścieżce `/explore` aktywna pozycja nawigacji jest wyróżniona w Topbarze.

---
-   *ID:* US-024
-   *Tytuł:* Publiczne szczegóły przepisu bez sidebara pod `/explore/recipes/:id-:slug`
-   *Opis:* Jako użytkownik (gość lub zalogowany), chcę wejść w szczegóły przepisu z katalogu publicznego (`/explore`) pod ścieżką `/explore/recipes/:id-:slug`, aby zobaczyć treść przepisu w tym samym układzie co w widoku prywatnym, ale bez sidebara i bez konieczności logowania.
-   *Kryteria akceptacji:*
    1.  Wejście na `/explore/recipes/:id-:slug` nie wymaga logowania i nie wyświetla Sidebara.
    2.  Wejście na `/explore/recipes/:id` (bez sluga) automatycznie normalizuje adres do kanonicznego `/explore/recipes/:id-:slug`.
    2.  Jeśli przepis ma widoczność `Publiczny`, treść przepisu wyświetla się dla wszystkich.
    3.  Jeśli przepis ma widoczność `Prywatny` lub `Współdzielony`:
        - gość otrzymuje `404`,
        - zalogowany nie-autora otrzymuje `404`,
        - zalogowany autor widzi przepis poprawnie.
    4.  Jeśli zalogowany autor ogląda swój przepis w `/explore/recipes/:id-:slug`, widzi akcje właściciela (np. "Edytuj", "Usuń") i może przejść do edycji.
    5.  Wejście na szczegóły przepisu z listy "Moje przepisy" prowadzi do chronionej, kanonicznej ścieżki `/recipes/:id-:slug` (z Sidebarem), z zachowaniem kompatybilności wstecznej dla `/recipes/:id` (normalizacja).

